<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Geye Pro: Ultimate AI Vision</title>

    <!-- AI CORE -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@0.0.6"></script>

    <style>
        :root {
            --primary: #E82127;
            /* Tesla Red */
            --primary-glow: rgba(232, 33, 39, 0.4);
            --secondary: #171a20;
            /* Tesla Dark Grey */
            --accent: #E82127;
            --success: #34C759;
            --warning: #FF9500;
            --glass: rgba(23, 26, 32, 0.85);
            /* High opacity dark background */
            --glass-dark: rgba(0, 0, 0, 0.9);
            --blur: blur(20px);
            --font-sf: 'Montserrat', 'Gotham', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            color: #fff;
            font-family: var(--font-sf);
            user-select: none;
            height: 100vh;
            width: 100vw;
            -webkit-tap-highlight-color: transparent;
        }

        /* TESLA BOOT SCREEN */
        #boot-screen {
            position: fixed;
            inset: 0;
            background: #000000;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: var(--font-sf);
        }

        .boot-animation {
            position: relative;
            width: 120px;
            height: 120px;
            margin-bottom: 40px;
        }

        .boot-logo {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: 700;
            color: var(--primary);
            opacity: 0;
            animation: logoReveal 2s ease-out 0.5s forwards;
            text-transform: uppercase;
            letter-spacing: 4px;
        }

        .boot-ring {
            position: absolute;
            inset: 0;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            opacity: 0;
            animation: ringReveal 1s ease-out 0.2s forwards;
        }

        .boot-subtitle {
            color: #fff;
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 4px;
            margin-bottom: 60px;
            text-align: center;
            opacity: 0;
            text-transform: uppercase;
            animation: subtitleReveal 1.5s ease-out 1s forwards;
        }

        .boot-progress {
            width: 200px;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0;
            overflow: hidden;
            position: relative;
        }

        .boot-progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 0;
        }

        .boot-status {
            color: rgba(255, 255, 255, 0.4);
            font-size: 12px;
            font-weight: 400;
            margin-top: 20px;
            text-align: center;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .activate-btn {
            background: transparent;
            border: 1px solid #fff;
            color: white;
            padding: 14px 40px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 40px;
            transition: all 0.3s ease;
            letter-spacing: 2px;
            text-transform: uppercase;
            opacity: 0;
            animation: buttonReveal 1s ease-out 2s forwards;
        }

        .activate-btn:hover {
            background: #fff;
            color: #000;
            transform: translateY(-2px);
        }

        @keyframes logoReveal {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes ringReveal {
            to {
                opacity: 1;
            }
        }

        @keyframes subtitleReveal {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes buttonReveal {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* MAIN CAMERA VIEW */
        #camera-view {
            position: fixed;
            inset: 0;
            background: #000;
            transition: all 0.3s ease;
        }

        #camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        #overlay-canvas {
            position: absolute;
            inset: 0;
            pointer-events: none;
        }

        /* CROSSHAIR REMOVED */

        /* ENHANCED GLASS UI */
        .glass-panel {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
        }

        /* FLOATING CONTROL BUTTON */
        /* FLOATING CONTROL BUTTON */
        #toggle-ui {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 48px;
            height: 48px;
            background: var(--glass);
            backdrop-filter: var(--blur);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        #toggle-ui:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.1) rotate(90deg);
        }

        /* FULLSCREEN CONTROLS */
        #fullscreen-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .screen-btn {
            width: 44px;
            height: 44px;
            background: var(--glass);
            backdrop-filter: var(--blur);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .screen-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .screen-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 0 15px var(--primary-glow);
        }

        /* MAIN UI CONTAINER */
        #main-ui {
            position: fixed;
            top: 90px;
            right: 20px;
            width: 360px;
            max-height: calc(100vh - 110px);
            opacity: 0;
            transform: translateX(120px);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            pointer-events: none;
            z-index: 999;
            overflow-y: auto;
        }

        #main-ui.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: all;
        }

        /* TAB NAVIGATION */
        .tab-navigation {
            display: flex;
            gap: 4px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 12px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 16px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 70px;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 20px rgba(0, 122, 255, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* STATUS PANEL */
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .status-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }

        .status-value {
            font-size: 14px;
            font-weight: 600;
            color: white;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 4px;
            margin-right: 10px;
        }

        .indicator-online {
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
        }

        .indicator-warning {
            background: var(--warning);
            box-shadow: 0 0 10px var(--warning);
        }

        .indicator-offline {
            background: #666;
        }

        /* ANALYTICS PANEL */
        .metric-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 12px;
        }

        .metric-card {
            background: var(--glass-dark);
            border-radius: 18px;
            padding: 18px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric-value {
            font-size: 26px;
            font-weight: 700;
            color: white;
            line-height: 1;
            margin-bottom: 6px;
        }

        .metric-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        /* CONTROLS PANEL */
        .control-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 12px;
        }

        .control-btn {
            background: var(--glass-dark);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            padding: 14px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        /* MEDIA CONTROLS */
        #media-controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 16px;
            z-index: 100;
            background: var(--glass);
            backdrop-filter: var(--blur);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 30px;
            padding: 16px;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4);
        }

        .media-btn {
            width: 56px;
            height: 56px;
            background: var(--glass-dark);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .media-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .media-btn.recording {
            background: var(--accent);
            animation: pulse 1.5s infinite;
            border-radius: 50%;
        }

        .media-btn.capturing {
            background: var(--success);
            transform: scale(0.95);
        }

        /* ZOOM CONTROLS */
        #zoom-controls {
            position: fixed;
            bottom: 120px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        .zoom-btn {
            width: 44px;
            height: 44px;
            background: var(--glass);
            backdrop-filter: var(--blur);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .zoom-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 0 15px var(--primary-glow);
        }

        .zoom-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(-2px);
        }

        /* FILTER CONTROLS */
        #filter-controls {
            position: fixed;
            bottom: 120px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        .filter-btn {
            width: 44px;
            height: 44px;
            background: var(--glass);
            backdrop-filter: var(--blur);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: var(--secondary);
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(232, 33, 39, 0.4);
        }

        .filter-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(2px);
        }

        .filter-btn.active {
            background: var(--secondary);
            box-shadow: 0 0 25px rgba(88, 86, 214, 0.4);
            transform: scale(1.1);
        }

        .filter-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.05);
        }

        /* ALERT NOTIFICATION */
        #alert-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--glass);
            backdrop-filter: var(--blur);
            border: 1px solid var(--accent);
            border-radius: 20px;
            padding: 16px 32px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            display: none;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(255, 45, 85, 0.3);
            text-align: center;
            max-width: 80%;
        }

        /* SETTINGS PANEL */
        .setting-item {
            margin: 16px 0;
        }

        .setting-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
            display: block;
            font-weight: 500;
        }

        .setting-control {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            background: var(--glass-dark);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
        }

        /* HELP SYSTEM */
        .help-section {
            margin: 16px 0;
            padding: 18px;
            background: var(--glass-dark);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .help-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .help-content {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.5;
        }

        /* SHARING PANEL */
        .share-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 12px 0;
        }

        .share-btn {
            background: var(--glass-dark);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .share-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        /* VIBRATION FEEDBACK */
        @media (hover: none) and (pointer: coarse) {

            .control-btn:active,
            .media-btn:active,
            .zoom-btn:active,
            .filter-btn:active {
                transform: scale(0.95);
            }
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 768px) {
            #main-ui {
                width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
            }

            .tab-navigation {
                gap: 3px;
            }

            .tab-btn {
                font-size: 11px;
                padding: 8px 12px;
                min-width: 60px;
            }

            #media-controls {
                bottom: 20px;
                padding: 12px;
                gap: 12px;
            }

            .media-btn {
                width: 54px;
                height: 54px;
                font-size: 20px;
            }
        }

        /* ACCESSIBILITY */
        .high-contrast {
            --primary: #FFFFFF;
            --glass: rgba(0, 0, 0, 0.9);
            color: #000;
        }

        .large-text {
            font-size: 18px;
        }

        /* SCREEN LOCK INDICATOR */
        .lock-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 20px 30px;
            color: white;
            font-weight: 600;
            font-size: 16px;
            display: none;
            z-index: 1000;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4);
        }

        /* FILTER EFFECTS */
        .filter-thermal {
            filter: hue-rotate(180deg) saturate(2) contrast(1.5) brightness(0.8);
        }

        .filter-night {
            filter: brightness(0.6) contrast(1.4) grayscale(0.3);
        }

        .filter-enhanced {
            filter: contrast(1.3) saturate(1.4) brightness(1.1);
        }

        /* HAPTIC FEEDBACK ANIMATION */
        @keyframes hapticPulse {
            0% {
                transform: scale(1);
            }

            25% {
                transform: scale(0.98);
            }

            50% {
                transform: scale(0.96);
            }

            75% {
                transform: scale(0.98);
            }

            100% {
                transform: scale(1);
            }
        }

        .haptic-feedback {
            animation: hapticPulse 0.15s ease-in-out;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }
    </style>
</head>

<body>
    <!-- APPLE TESLA BOOT SCREEN -->
    <div id="boot-screen">
        <div class="boot-animation">
            <div class="boot-ring"></div>
            <div class="boot-logo">G</div>
        </div>
        <div class="boot-subtitle">AI VISION SYSTEM</div>
        <div class="boot-progress">
            <div class="boot-progress-bar" id="boot-progress"></div>
        </div>
        <div class="boot-status" id="boot-status">Initializing Neural Core</div>
        <button class="activate-btn" id="btn-activate" style="display:none;">ACTIVATE SYSTEM</button>
    </div>

    <!-- MAIN CAMERA VIEW -->
    <div id="camera-view">
        <video id="camera-feed" autoplay playsinline muted></video>
        <canvas id="overlay-canvas"></canvas>

        <!-- CROSSHAIR REMOVED -->
    </div>

    <div id="fullscreen-controls">
        <button class="screen-btn" id="btn-fullscreen" title="Fullscreen">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path
                    d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3" />
            </svg>
        </button>
        <button class="screen-btn" id="btn-lock" title="Lock Orientation">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
        </button>
    </div>

    <!-- LANGUAGE SELECTOR MOVED TO SETTINGS -->

    <!-- FLOATING UI TOGGLE -->
    <div id="toggle-ui">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
            </path>
        </svg>
    </div>

    <!-- MEDIA CONTROLS -->
    <div id="media-controls">
        <button class="media-btn" id="btn-capture" title="Capture Photo">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
            </svg>
        </button>
        <button class="media-btn" id="btn-record" title="Record Video">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M23 7l-7 5 7 5V7z"></path>
                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
            </svg>
        </button>
        <button class="media-btn" id="btn-audio" title="Record Audio">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                <line x1="12" y1="19" x2="12" y2="23"></line>
                <line x1="8" y1="23" x2="16" y2="23"></line>
            </svg>
        </button>
    </div>

    <!-- ZOOM CONTROLS -->
    <div id="zoom-controls">
        <div class="zoom-btn active" data-zoom="1">1x</div>
        <div class="zoom-btn" data-zoom="2">2x</div>
        <div class="zoom-btn" data-zoom="4">4x</div>
    </div>

    <!-- FILTER CONTROLS -->
    <div id="filter-controls">
        <button class="filter-btn" data-filter="normal" title="Normal View">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
            </svg>
        </button>
        <button class="filter-btn" data-filter="thermal" title="Thermal Simulation">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
            </svg>
        </button>
        <button class="filter-btn" data-filter="night" title="Night Vision">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
        </button>
        <button class="filter-btn" data-filter="enhanced" title="Enhanced">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <polygon
                    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                </polygon>
            </svg>
        </button>
    </div>

    <!-- MAIN UI CONTAINER -->
    <div id="main-ui">
        <!-- TAB NAVIGATION -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="vision">Vision</button>
            <button class="tab-btn" data-tab="pro">Pro Mode</button>
            <button class="tab-btn" data-tab="audio">Audio</button>
            <button class="tab-btn" data-tab="share">Share</button>
            <button class="tab-btn" data-tab="reports">Reports</button>
            <button class="tab-btn" data-tab="backup">Backup</button>
            <button class="tab-btn" data-tab="help">Help</button>
            <button class="tab-btn" data-tab="settings">Settings</button>
        </div>

        <!-- VISION TAB -->
        <div class="tab-content active" id="vision-tab">
            <div class="glass-panel" style="padding: 24px; margin-bottom: 12px;">
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 20px; font-weight: 700; margin-bottom: 6px;">Geye Pro</div>
                    <div style="font-size: 13px; color: rgba(255,255,255,0.6); letter-spacing: 0.5px;">Professional AI
                        Vision System</div>
                </div>

                <div class="status-item">
                    <div style="display:flex;align-items:center;">
                        <div class="status-indicator indicator-online"></div>
                        <span class="status-label">AI CORE</span>
                    </div>
                    <span class="status-value" id="ai-status">ONLINE</span>
                </div>
                <div class="status-item">
                    <span class="status-label">PROCESSING FPS</span>
                    <span class="status-value" id="fps-counter">0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">DETECTIONS</span>
                    <span class="status-value" id="detection-count">0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">THREAT LEVEL</span>
                    <span class="status-value" id="threat-level">LOW</span>
                </div>
            </div>

            <div class="glass-panel" style="padding: 24px;">
                <div class="status-label" style="margin-bottom: 12px;">LIVE ANALYTICS</div>
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="people-count">0</div>
                        <div class="metric-label">PEOPLE</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="vehicle-count">0</div>
                        <div class="metric-label">VEHICLES</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="distance-val">--</div>
                        <div class="metric-label">DISTANCE</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="confidence-val">--%</div>
                        <div class="metric-label">CONFIDENCE</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PRO MODE TAB -->
        <div class="tab-content" id="pro-tab">
            <div class="glass-panel" style="padding: 24px;">
                <div class="status-label" style="margin-bottom: 20px;">PRO CAMERA SETTINGS</div>

                <div class="setting-item">
                    <span class="setting-label">ISO <span id="iso-val"
                            style="float:right; color:var(--primary);">AUTO</span></span>
                    <input type="range" class="setting-control" id="iso-slider" min="100" max="3200" step="100"
                        disabled>
                </div>

                <div class="setting-item">
                    <span class="setting-label">Shutter Speed <span id="shutter-val"
                            style="float:right; color:var(--primary);">AUTO</span></span>
                    <input type="range" class="setting-control" id="shutter-slider" min="0" max="1000" step="1"
                        disabled>
                </div>

                <div class="setting-item">
                    <span class="setting-label">White Balance <span id="wb-val"
                            style="float:right; color:var(--primary);">AUTO</span></span>
                    <input type="range" class="setting-control" id="wb-slider" min="2000" max="8000" step="100"
                        disabled>
                </div>

                <div class="setting-item">
                    <span class="setting-label">Focus Distance <span id="focus-val"
                            style="float:right; color:var(--primary);">AUTO</span></span>
                    <input type="range" class="setting-control" id="focus-slider" min="0" max="100" step="1" disabled>
                </div>

                <div class="setting-item">
                    <span class="setting-label">Exposure Compensation <span id="exposure-val"
                            style="float:right; color:var(--primary);">0</span></span>
                    <input type="range" class="setting-control" id="exposure-slider" min="-3" max="3" step="0.5"
                        value="0">
                </div>

                <div style="margin-top: 20px; font-size: 11px; color: rgba(255,255,255,0.4);">
                    * Pro controls depend on hardware support. Unavailable controls are disabled.
                </div>
            </div>
        </div>

        <!-- AUDIO TAB -->
        <div class="tab-content" id="audio-tab">
            <div class="glass-panel" style="padding: 24px; text-align: center;">
                <div class="status-label" style="margin-bottom: 20px;">AUDIO ANALYTICS</div>
                <div style="font-size: 48px; margin-bottom: 10px;">Waiting...</div>
                <div style="font-size: 12px; color: rgba(255,255,255,0.5);">Audio visualization coming soon</div>
            </div>
        </div>

        <!-- SHARE TAB -->
        <div class="tab-content" id="share-tab">
            <div class="glass-panel" style="padding: 24px;">
                <div class="status-label" style="margin-bottom: 20px;">SHARE DATA</div>
                <div class="share-options">
                    <div class="share-btn">Export CSV</div>
                    <div class="share-btn">Export JSON</div>
                    <div class="share-btn">Cloud Sync</div>
                    <div class="share-btn">Live Stream</div>
                </div>
            </div>
        </div>

        <!-- REPORTS TAB -->
        <div class="tab-content" id="reports-tab">
            <div class="glass-panel" style="padding: 24px;">
                <div class="status-label" style="margin-bottom: 20px;">INCIDENT REPORTS</div>
                <div style="font-size: 13px; color: rgba(255,255,255,0.6); text-align: center; padding: 20px;">
                    No incidents recorded in current session.
                </div>
            </div>
        </div>

        <!-- BACKUP TAB -->
        <div class="tab-content" id="backup-tab">
            <div class="glass-panel" style="padding: 24px;">
                <div class="status-label" style="margin-bottom: 20px;">SYSTEM BACKUP</div>
                <div class="control-btn" style="width: 100%; margin-bottom: 10px;">Create Local Backup</div>
                <div class="control-btn" style="width: 100%;">Restore from File</div>
            </div>
        </div>

        <!-- HELP TAB -->
        <div class="tab-content" id="help-tab">
            <div class="glass-panel" style="padding: 24px;">
                <div class="status-label" style="margin-bottom: 20px;">SYSTEM GUIDE</div>
                <div class="help-section">
                    <div class="help-title">Pro Mode Controls</div>
                    <div class="help-content">
                        Use the sliders to adjust ISO, Shutter Speed, and Focus. These features require compatible
                        hardware.
                    </div>
                </div>
                <div class="help-section">
                    <div class="help-title">AI Detection</div>
                    <div class="help-content">
                        The system automatically detects people and vehicles. Threat levels are calculated based on
                        proximity.
                    </div>
                </div>
            </div>
        </div>

        <!-- SETTINGS TAB -->
        <div class="tab-content" id="settings-tab">
            <div class="glass-panel" style="padding: 24px;">
                <div class="status-label" style="margin-bottom: 20px;">SYSTEM PREFERENCES</div>

                <div class="setting-item">
                    <span class="setting-label">Language</span>
                    <select class="setting-control" id="language-select">
                        <option value="en">English</option>
                        <option value="th">Thai</option>
                        <option value="zh">Chinese</option>
                        <option value="ja">Japanese</option>
                    </select>
                </div>

                <div class="setting-item">
                    <span class="setting-label">Confidence Threshold</span>
                    <input type="range" class="setting-control" min="0.1" max="0.9" step="0.1" value="0.5"
                        id="conf-slider">
                </div>

                <div class="setting-item">
                    <span class="setting-label">Haptic Feedback</span>
                    <div style="display: flex; gap: 10px;">
                        <button class="control-btn" style="flex:1" onclick="app.toggleHaptic(true)">ON</button>
                        <button class="control-btn" style="flex:1" onclick="app.toggleHaptic(false)">OFF</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ALERT NOTIFICATION -->
    <div id="alert-notification"></div>

    <!-- SCREEN LOCK INDICATOR -->
    <div class="lock-indicator" id="lock-indicator">
        Screen Orientation Locked
    </div>

    <script>
        /**
         * ðŸš€ Geye Pro: Ultimate AI Vision Suite (Apple Tesla Edition)
         * Enterprise-grade computer vision system with premium UX
         */

        class GeyeProUltimate {
            constructor() {
                // Core Components
                this.video = document.getElementById('camera-feed');
                this.overlayCanvas = document.getElementById('overlay-canvas');
                this.overlayCtx = this.overlayCanvas.getContext('2d');

                // AI Models
                this.objectDetector = null;
                this.poseDetector = null;

                // System State
                this.isActive = false;
                this.isUIVisible = false;
                this.zoomLevel = 1;
                this.currentFilter = 'normal';
                this.isFullscreen = false;
                this.isOrientationLocked = false;
                this.isRecording = false;
                this.frameCount = 0;
                this.fps = 0;
                this.lastFpsUpdate = 0;
                this.startTime = Date.now();

                // Media Recording
                this.mediaRecorder = null;
                this.recordedChunks = [];
                this.recordings = [];
                this.audioRecorder = null;
                this.audioChunks = [];
                this.audioRecordings = [];
                this.recordStartTime = 0;
                this.activeStream = null;

                // Analytics
                this.analytics = {
                    peopleCount: 0,
                    vehicleCount: 0,
                    totalDetections: 0,
                    nearestDistance: 9999,
                    totalCaptures: 0,
                    totalRecordings: 0,
                    totalAudioRecordings: 0
                };

                // Settings
                this.settings = {
                    confidence: 0.5,
                    language: 'en',
                    accessibility: 'normal',
                    autoBackup: 'off',
                    soundDetection: 'off',
                    hapticFeedback: true,
                    thermalSimulation: true
                };

                this.initializeSystem();
            }

            async initializeSystem() {
                try {
                    this.updateBootProgress(10, "Booting Neural Core...");
                    await this.delay(800);

                    this.updateBootProgress(30, "Loading AI Models...");
                    await this.delay(600);

                    // Load Object Detection
                    this.updateBootProgress(50, "Initializing Object Detection...");
                    this.objectDetector = await cocoSsd.load({
                        base: 'lite_mobilenet_v2'
                    });

                    // Load Pose Detection
                    this.updateBootProgress(70, "Loading Pose Detection...");
                    this.poseDetector = await poseDetection.createDetector(
                        poseDetection.SupportedModels.MoveNet,
                        {
                            modelType: poseDetection.movenet.modelType.SINGLEPOSE_THUNDER
                        }
                    );

                    // Initialize Media Systems with the SAME stream
                    this.updateBootProgress(85, "Initializing Media Systems...");
                    // Media systems are initialized in activateSystem to use the active stream

                    this.updateBootProgress(95, "Finalizing Systems...");
                    this.setupEventListeners(); // Setup listeners BEFORE activation
                    this.initializeCanvas();
                    this.loadSettings();

                    this.updateBootProgress(100, "System Ready");
                    await this.delay(500);
                    document.getElementById('btn-activate').style.display = 'block';

                } catch (error) {
                    this.handleCriticalError(error);
                }
            }

            // REMOVED initializeMediaSystems - logic moved to activateSystem to share stream

            setupMediaRecorder() {
                this.mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        this.recordedChunks.push(event.data);
                    }
                };

                this.mediaRecorder.onstop = () => {
                    const videoBlob = new Blob(this.recordedChunks, { type: 'video/mp4' });
                    this.saveRecording(videoBlob);
                    this.recordedChunks = [];
                };
            }

            setupAudioRecorder() {
                this.audioRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        this.audioChunks.push(event.data);
                    }
                };

                this.audioRecorder.onstop = () => {
                    const audioBlob = new Blob(this.audioChunks, { type: 'audio/wav' });
                    this.saveAudioRecording(audioBlob);
                    this.audioChunks = [];
                };
            }

            updateBootProgress(percent, message) {
                document.getElementById('boot-progress').style.width = percent + '%';
                document.getElementById('boot-status').textContent = message;
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            setupEventListeners() {
                // Enhanced event listeners with error handling
                this.setupUIEvents();
                this.setupMediaEvents();
                this.setupSystemEvents();
                this.setupAccessibilityEvents();
            }

            setupUIEvents() {
                // UI Toggle
                document.getElementById('toggle-ui').addEventListener('click', () => this.toggleUI());

                // Tab Navigation
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.switchTab(e.target.dataset.tab);
                        this.triggerHaptic();
                    });
                });

                // Fullscreen Controls
                document.getElementById('btn-fullscreen').addEventListener('click', () => this.toggleFullscreen());
                document.getElementById('btn-lock').addEventListener('click', () => this.toggleOrientationLock());

                // Zoom Controls
                document.querySelectorAll('.zoom-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const target = e.target.closest('.zoom-btn');
                        if (target) {
                            const zoomLevel = parseInt(target.dataset.zoom);
                            this.setZoom(zoomLevel, target);
                            this.triggerHaptic();
                        }
                    });
                });

                // Filter Controls
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        // Ensure we get the button element even if child SVG is clicked
                        const target = e.target.closest('.filter-btn');
                        if (target) {
                            const filter = target.dataset.filter;
                            this.setFilter(filter, target);
                            this.triggerHaptic();
                        }
                    });
                });
            }

            setupMediaEvents() {
                // Media Controls
                document.getElementById('btn-capture').addEventListener('click', () => {
                    this.capturePhoto();
                    this.triggerHaptic();
                });

                document.getElementById('btn-record').addEventListener('click', () => {
                    this.toggleVideoRecording();
                    this.triggerHaptic();
                });

                document.getElementById('btn-audio').addEventListener('click', () => {
                    this.toggleAudioRecording();
                    this.triggerHaptic();
                });
            }

            setupSystemEvents() {
                // System Controls
                document.getElementById('btn-activate').addEventListener('click', () => this.activateSystem());

                // Language Selector
                document.getElementById('language-select').addEventListener('change', (e) => {
                    this.changeLanguage(e.target.value);
                });

                // Keyboard Shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.key === ' ') this.capturePhoto();
                    if (e.key === 'r' || e.key === 'R') this.toggleVideoRecording();
                    if (e.key === 'a' || e.key === 'A') this.toggleAudioRecording();
                    if (e.key === 'Escape') this.toggleUI();
                    if (e.key === 'f' || e.key === 'F') this.toggleFullscreen();
                    if (e.key === '1') this.setZoom(1);
                    if (e.key === '2') this.setZoom(2);
                    if (e.key === '4') this.setZoom(4);
                });

                // Handle orientation changes
                window.addEventListener('orientationchange', () => this.handleOrientationChange());

                // Handle fullscreen changes
                document.addEventListener('fullscreenchange', () => {
                    this.isFullscreen = !!document.fullscreenElement;
                });

                // Handle page visibility
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        this.pauseSystem();
                    } else {
                        this.resumeSystem();
                    }
                });
            }

            setupAccessibilityEvents() {
                // Touch event handlers for better mobile experience
                document.addEventListener('touchstart', (e) => {
                    // Prevent default to avoid browser handling
                    if (e.target.classList.contains('control-btn') ||
                        e.target.classList.contains('media-btn')) {
                        e.preventDefault();
                    }
                }, { passive: false });
            }

            triggerHaptic() {
                if (this.settings.hapticFeedback && navigator.vibrate) {
                    navigator.vibrate(50);
                }
            }

            initializeCanvas() {
                this.overlayCanvas.width = window.innerWidth;
                this.overlayCanvas.height = window.innerHeight;
            }

            loadSettings() {
                try {
                    const saved = localStorage.getItem('geye_pro_ultimate_settings');
                    if (saved) {
                        this.settings = { ...this.settings, ...JSON.parse(saved) };
                    }
                } catch (error) {
                    console.warn('Settings load failed:', error);
                }
            }

            saveSettings() {
                try {
                    localStorage.setItem('geye_pro_ultimate_settings', JSON.stringify(this.settings));
                } catch (error) {
                    console.warn('Settings save failed:', error);
                }
            }

            async activateSystem() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: {
                            facingMode: 'environment',
                            width: { ideal: 1920 },
                            height: { ideal: 1080 }
                        },
                        audio: false
                    });

                    this.video.srcObject = stream;
                    this.activeStream = stream; // Store stream for media recorders

                    // Initialize Media Recorders with the active stream
                    this.initializeMediaRecorders(stream);

                    // Initialize Pro Mode Capabilities
                    this.initializeProMode(stream);

                    await new Promise((resolve, reject) => {
                        this.video.onloadedmetadata = () => {
                            this.video.play().then(resolve).catch(reject);
                        };
                        this.video.onerror = reject;
                    });

                    document.getElementById('boot-screen').style.display = 'none';
                    this.isActive = true;

                    this.showAlert("Geye Pro System Activated", false);

                    // Initial canvas setup
                    this.handleResize();
                    window.addEventListener('resize', () => this.handleResize());

                    this.startMainLoop();
                    this.startSystemMonitoring();

                } catch (error) {
                    this.handleCriticalError(error);
                }
            }

            toggleFullscreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(() => {
                        this.showAlert("Fullscreen not supported", true);
                    });
                } else {
                    document.exitFullscreen();
                }
            }

            toggleOrientationLock() {
                if (screen.orientation && screen.orientation.lock) {
                    if (!this.isOrientationLocked) {
                        screen.orientation.lock('landscape').then(() => {
                            this.isOrientationLocked = true;
                            document.getElementById('btn-lock').classList.add('active');
                            this.showLockIndicator();
                        }).catch(() => {
                            this.showAlert("Orientation lock not supported", true);
                        });
                    } else {
                        screen.orientation.unlock();
                        this.isOrientationLocked = false;
                        document.getElementById('btn-lock').classList.remove('active');
                    }
                }
            }

            showLockIndicator() {
                const indicator = document.getElementById('lock-indicator');
                indicator.style.display = 'block';
                setTimeout(() => {
                    indicator.style.display = 'none';
                }, 2000);
            }

            setZoom(level, targetBtn) {
                this.zoomLevel = level;
                this.video.style.transform = `scale(${level})`;
                this.video.style.transformOrigin = 'center center';

                // Update UI
                document.querySelectorAll('.zoom-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                if (targetBtn) targetBtn.classList.add('active');
            }

            setFilter(filter, targetBtn) {
                this.currentFilter = filter;
                this.video.className = `filter-${filter}`;

                // Update UI
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                if (targetBtn) targetBtn.classList.add('active');

                this.showAlert(`Filter: ${filter.charAt(0).toUpperCase() + filter.slice(1)}`);
            }

            capturePhoto() {
                const btn = document.getElementById('btn-capture');
                btn.classList.add('capturing');

                setTimeout(() => {
                    const canvas = document.createElement('canvas');
                    canvas.width = this.video.videoWidth;
                    canvas.height = this.video.videoHeight;
                    const ctx = canvas.getContext('2d');

                    // Apply current filter to capture
                    ctx.filter = this.getFilterStyle(this.currentFilter);
                    ctx.drawImage(this.video, 0, 0);
                    ctx.drawImage(this.overlayCanvas, 0, 0);

                    // Create download
                    const link = document.createElement('a');
                    link.download = `geye_capture_${Date.now()}.png`;
                    link.href = canvas.toDataURL('image/png', 0.95);
                    link.click();

                    // Update analytics
                    this.analytics.totalCaptures++;
                    this.showAlert("Photo Captured");

                    btn.classList.remove('capturing');
                }, 300);
            }

            getFilterStyle(filter) {
                const styles = {
                    normal: 'none',
                    thermal: 'hue-rotate(180deg) saturate(2) contrast(1.5) brightness(0.8)',
                    night: 'brightness(0.6) contrast(1.4) grayscale(0.3)',
                    enhanced: 'contrast(1.3) saturate(1.4) brightness(1.1)'
                };
                return styles[filter] || 'none';
            }

            toggleVideoRecording() {
                if (!this.mediaRecorder) {
                    this.showAlert("Video recording not available", true);
                    return;
                }

                const btn = document.getElementById('btn-record');

                if (this.isRecording) {
                    this.mediaRecorder.stop();
                    this.isRecording = false;
                    btn.classList.remove('recording');
                    this.showAlert("Recording saved");
                } else {
                    this.mediaRecorder.start();
                    this.isRecording = true;
                    this.recordStartTime = Date.now();
                    btn.classList.add('recording');
                    this.showAlert("Recording started");
                }
            }

            toggleAudioRecording() {
                if (!this.audioRecorder) {
                    this.showAlert("Audio recording not available", true);
                    return;
                }

                const btn = document.getElementById('btn-audio');

                if (this.audioRecorder.state === 'recording') {
                    this.audioRecorder.stop();
                    btn.classList.remove('recording');
                    this.showAlert("Audio recording saved");
                } else {
                    this.audioRecorder.start();
                    btn.classList.add('recording');
                    this.showAlert("Audio recording started");
                }
            }

            saveRecording(blob) {
                this.recordings.push({
                    blob: blob,
                    timestamp: new Date().toISOString(),
                    duration: Date.now() - this.recordStartTime
                });
                this.analytics.totalRecordings++;
            }

            initializeMediaRecorders(stream) {
                try {
                    // Video Recorder - Try supported MIME types
                    const videoTypes = ['video/webm;codecs=vp9', 'video/webm', 'video/mp4'];
                    let videoOptions = {};
                    for (const type of videoTypes) {
                        if (MediaRecorder.isTypeSupported(type)) {
                            videoOptions = { mimeType: type };
                            break;
                        }
                    }

                    this.mediaRecorder = new MediaRecorder(stream, videoOptions);
                    this.setupMediaRecorder();

                    // Audio Recorder - Use same stream, try supported audio types
                    const audioTypes = ['audio/webm;codecs=opus', 'audio/webm', 'audio/ogg', 'audio/mp4'];
                    let audioOptions = {};
                    for (const type of audioTypes) {
                        if (MediaRecorder.isTypeSupported(type)) {
                            audioOptions = { mimeType: type };
                            break;
                        }
                    }

                    // Create a separate audio-only stream if needed, or just use the main stream
                    // Using main stream is fine for MediaRecorder as it will pick up the audio track
                    this.audioRecorder = new MediaRecorder(stream, audioOptions);
                    this.setupAudioRecorder();
                } catch (e) {
                    console.warn("MediaRecorder init failed:", e);
                    this.showAlert("Media Recording Unavailable", true);
                }
            }

            initializeProMode(stream) {
                const track = stream.getVideoTracks()[0];
                const capabilities = track.getCapabilities();
                const settings = track.getSettings();

                // Helper to setup slider
                const setupSlider = (id, capKey, settingKey, labelId, unit = '') => {
                    const slider = document.getElementById(id);
                    const label = document.getElementById(labelId);

                    if (capabilities[capKey]) {
                        slider.min = capabilities[capKey].min;
                        slider.max = capabilities[capKey].max;
                        slider.step = capabilities[capKey].step;
                        slider.value = settings[settingKey];
                        slider.disabled = false;

                        slider.addEventListener('input', async (e) => {
                            const value = parseFloat(e.target.value);
                            label.textContent = value + unit;
                            try {
                                await track.applyConstraints({
                                    advanced: [{ [capKey]: value }]
                                });
                            } catch (err) {
                                console.warn(`Failed to set ${capKey}:`, err);
                            }
                        });
                    } else {
                        slider.disabled = true;
                        label.textContent = 'N/A';
                    }
                };

                setupSlider('iso-slider', 'iso', 'iso', 'iso-val');
                setupSlider('shutter-slider', 'exposureTime', 'exposureTime', 'shutter-val', 'ms');
                setupSlider('wb-slider', 'whiteBalanceMode', 'whiteBalanceMode', 'wb-val', 'K'); // Simplified
                setupSlider('focus-slider', 'focusDistance', 'focusDistance', 'focus-val', 'm');
                setupSlider('exposure-slider', 'exposureCompensation', 'exposureCompensation', 'exposure-val');

                // Special handling for White Balance Mode vs Temperature
                if (capabilities.whiteBalanceMode && Array.isArray(capabilities.whiteBalanceMode) && capabilities.whiteBalanceMode.includes('manual')) {
                    // If manual WB is supported, try to enable it
                    track.applyConstraints({ advanced: [{ whiteBalanceMode: 'manual' }] }).catch(e => console.log(e));
                }
            }

            saveAudioRecording(blob) {
                this.audioRecordings.push({
                    blob: blob,
                    timestamp: new Date().toISOString()
                });
                this.analytics.totalAudioRecordings++;
            }

            // ... (keep all existing AI vision functionality from previous versions)

            switchTab(tabName) {
                // Guard against invalid tabs
                const targetTab = document.getElementById(`${tabName}-tab`);
                if (!targetTab) {
                    console.warn(`Tab ${tabName} not found`);
                    return;
                }

                // Update tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
                if (activeBtn) activeBtn.classList.add('active');

                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                targetTab.classList.add('active');
            }

            toggleUI() {
                const mainUI = document.getElementById('main-ui');
                const toggleBtn = document.getElementById('toggle-ui');

                this.isUIVisible = !this.isUIVisible;
                mainUI.classList.toggle('active', this.isUIVisible);
                // Update icon based on state
                if (this.isUIVisible) {
                    toggleBtn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>';
                } else {
                    toggleBtn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>';
                }
                this.triggerHaptic();
            }

            changeLanguage(lang) {
                // Enhanced language switching
                const translations = {
                    en: { activate: "ACTIVATE SYSTEM", online: "ONLINE", people: "PEOPLE" },
                    th: { activate: "à¹€à¸›à¸´à¸”à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸£à¸°à¸šà¸š", online: "à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ", people: "à¸šà¸¸à¸„à¸„à¸¥" },
                    zh: { activate: "æ¿€æ´»ç³»ç»Ÿ", online: "åœ¨çº¿", people: "äººå‘˜" },
                    ja: { activate: "ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•", online: "ã‚ªãƒ³ãƒ©ã‚¤ãƒ³", people: "äººç‰©" }
                };

                const t = translations[lang] || translations.en;
                document.getElementById('btn-activate').textContent = t.activate;
                document.getElementById('ai-status').textContent = t.online;
                // Add more translations as needed
            }

            handleOrientationChange() {
                // Handle orientation changes gracefully
                this.initializeCanvas();
            }

            pauseSystem() {
                this.isActive = false;
            }

            resumeSystem() {
                if (this.video.srcObject) {
                    this.isActive = true;
                    this.startMainLoop();
                }
            }

            startSystemMonitoring() {
                setInterval(() => {
                    // System health monitoring
                    this.monitorSystemHealth();
                }, 30000);
            }

            monitorSystemHealth() {
                // Monitor memory usage
                if (performance.memory) {
                    const used = performance.memory.usedJSHeapSize;
                    const limit = performance.memory.jsHeapSizeLimit;
                    if (used / limit > 0.8) {
                        this.showAlert("High memory usage", true);
                    }
                }

                // Monitor FPS
                if (this.fps < 15) {
                    this.showAlert("Low performance detected", true);
                }
            }

            showAlert(message, isError = false) {
                const alert = document.getElementById('alert-notification');
                alert.textContent = message;
                alert.style.borderColor = isError ? '#FF2D55' : '#007AFF';
                alert.style.display = 'block';

                setTimeout(() => {
                    alert.style.display = 'none';
                }, 3000);
            }

            handleCriticalError(error) {
                console.error('Critical system error:', error);
                document.getElementById('boot-status').textContent = 'System Error - Please Refresh';
                document.getElementById('boot-status').style.color = '#FF2D55';
                this.showAlert("Critical system error occurred", true);
            }

            // AI Vision Core Functionality (Maintained from previous versions)
            handleResize() {
                this.initializeCanvas();
                this.videoRect = this.calculateVideoRect();
            }

            calculateVideoRect() {
                if (!this.video || this.video.videoWidth === 0) return null;

                const videoRatio = this.video.videoWidth / this.video.videoHeight;
                const screenRatio = window.innerWidth / window.innerHeight;

                let drawWidth, drawHeight, startX, startY;

                if (screenRatio > videoRatio) {
                    // Screen is wider than video (crop top/bottom)
                    drawWidth = window.innerWidth;
                    drawHeight = drawWidth / videoRatio;
                    startX = 0;
                    startY = (window.innerHeight - drawHeight) / 2;
                } else {
                    // Screen is taller than video (crop sides)
                    drawHeight = window.innerHeight;
                    drawWidth = drawHeight * videoRatio;
                    startX = (window.innerWidth - drawWidth) / 2;
                    startY = 0;
                }

                return { x: startX, y: startY, w: drawWidth, h: drawHeight, scale: drawWidth / this.video.videoWidth };
            }

            async startMainLoop() {
                const loop = async () => {
                    if (!this.isActive) return;

                    // Guard: Video not ready
                    if (this.video.readyState < 2 || this.video.videoWidth === 0) {
                        requestAnimationFrame(loop);
                        return;
                    }

                    // Update video rect if needed
                    if (!this.videoRect) this.videoRect = this.calculateVideoRect();

                    this.frameCount++;
                    const now = Date.now();
                    if (now - this.lastFpsUpdate >= 1000) {
                        this.fps = this.frameCount;
                        this.frameCount = 0;
                        this.lastFpsUpdate = now;
                        document.getElementById('fps-counter').textContent = this.fps;
                    }

                    // Clear canvas
                    this.overlayCtx.clearRect(0, 0, this.overlayCanvas.width, this.overlayCanvas.height);

                    // AI Detection Logic
                    if (this.objectDetector && this.settings.confidence > 0) {
                        try {
                            const predictions = await this.objectDetector.detect(this.video);
                            this.drawDetections(predictions);
                            this.updateAnalytics(predictions);
                        } catch (e) {
                            // Silent fail for single frame error
                        }
                    }

                    if (this.poseDetector) {
                        try {
                            const poses = await this.poseDetector.estimatePoses(this.video);
                            if (poses.length > 0) {
                                this.drawPose(poses[0]);
                            }
                        } catch (e) {
                            // Silent fail
                        }
                    }

                    requestAnimationFrame(loop);
                };
                loop();
            }

            updateAnalytics(objects) {
                const people = objects.filter(obj => obj.class === 'person');
                const vehicles = objects.filter(obj =>
                    ['car', 'truck', 'bus', 'motorcycle'].includes(obj.class)
                );

                this.analytics.peopleCount = people.length;
                this.analytics.vehicleCount = vehicles.length;
                this.analytics.totalDetections += objects.length;

                // Calculate nearest distance
                this.analytics.nearestDistance = 9999;
                people.forEach(person => {
                    const distance = (1.7 * 900) / person.bbox[3];
                    if (distance < this.analytics.nearestDistance) {
                        this.analytics.nearestDistance = distance;
                    }
                });

                // Update UI
                this.updateUI(objects);
            }

            updateUI(objects) {
                // Update metrics
                document.getElementById('people-count').textContent = this.analytics.peopleCount;
                document.getElementById('vehicle-count').textContent = this.analytics.vehicleCount;
                document.getElementById('detection-count').textContent = this.analytics.totalDetections;

                // Update distance
                const distanceEl = document.getElementById('distance-val');
                if (this.analytics.nearestDistance !== 9999) {
                    distanceEl.textContent = this.analytics.nearestDistance.toFixed(1) + 'm';
                    distanceEl.style.color = this.analytics.nearestDistance < 10 ? '#FF2D55' : '#34C759';
                } else {
                    distanceEl.textContent = '--';
                    distanceEl.style.color = 'white';
                }

                // Update Threat Level
                const threatEl = document.getElementById('threat-level');
                if (this.analytics.peopleCount > 3 || this.analytics.nearestDistance < 2) {
                    threatEl.textContent = 'HIGH';
                    threatEl.style.color = '#FF2D55';
                } else if (this.analytics.peopleCount > 0) {
                    threatEl.textContent = 'MODERATE';
                    threatEl.style.color = '#FF9500';
                } else {
                    threatEl.textContent = 'LOW';
                    threatEl.style.color = '#34C759';
                }

                // Update Confidence
                const confEl = document.getElementById('confidence-val');
                if (objects.length > 0) {
                    const avgConf = objects.reduce((acc, obj) => acc + obj.score, 0) / objects.length;
                    confEl.textContent = Math.round(avgConf * 100) + '%';
                } else {
                    confEl.textContent = '--%';
                }
            }

            updatePerformanceMetrics(processingTime) {
                // Deprecated in favor of integrated loop FPS
            }

            getClassColor(className) {
                const colors = {
                    'person': '#FF2D55',
                    'car': '#007AFF',
                    'truck': '#007AFF',
                    'bus': '#007AFF',
                    'motorcycle': '#007AFF',
                    'dog': '#FF9500',
                    'cat': '#FF9500'
                };
                return colors[className] || '#34C759';
            }

            drawDetections(predictions) {
                if (!this.videoRect) return;
                const { x: offX, y: offY, scale } = this.videoRect;

                predictions.forEach(prediction => {
                    if (prediction.score < this.settings.confidence) return;

                    // Map coordinates
                    const [x, y, width, height] = prediction.bbox;
                    const drawX = offX + (x * scale);
                    const drawY = offY + (y * scale);
                    const drawW = width * scale;
                    const drawH = height * scale;

                    // Draw Box
                    this.overlayCtx.strokeStyle = this.getClassColor(prediction.class);
                    this.overlayCtx.lineWidth = 2;
                    this.overlayCtx.strokeRect(drawX, drawY, drawW, drawH);

                    // Draw Label
                    this.overlayCtx.fillStyle = this.getClassColor(prediction.class);
                    this.overlayCtx.globalAlpha = 0.8;
                    this.overlayCtx.fillRect(drawX, drawY - 24, drawW, 24);
                    this.overlayCtx.globalAlpha = 1.0;

                    this.overlayCtx.fillStyle = '#fff';
                    this.overlayCtx.font = 'bold 12px "Montserrat", sans-serif';
                    this.overlayCtx.fillText(
                        `${prediction.class.toUpperCase()} ${Math.round(prediction.score * 100)}%`,
                        drawX + 6,
                        drawY - 7
                    );
                });
            }

            drawPose(pose) {
                if (!this.videoRect) return;
                const { x: offX, y: offY, scale } = this.videoRect;

                if (pose.keypoints) {
                    const connections = [
                        ['left_shoulder', 'right_shoulder'],
                        ['left_shoulder', 'left_elbow'], ['left_elbow', 'left_wrist'],
                        ['right_shoulder', 'right_elbow'], ['right_elbow', 'right_wrist'],
                        ['left_shoulder', 'left_hip'], ['right_shoulder', 'right_hip'],
                        ['left_hip', 'right_hip'],
                        ['left_hip', 'left_knee'], ['left_knee', 'left_ankle'],
                        ['right_hip', 'right_knee'], ['right_knee', 'right_ankle']
                    ];

                    this.overlayCtx.strokeStyle = '#00ff00';
                    this.overlayCtx.lineWidth = 2;

                    connections.forEach(([jointA, jointB]) => {
                        const pointA = pose.keypoints.find(kp => kp.name === jointA);
                        const pointB = pose.keypoints.find(kp => kp.name === jointB);

                        if (pointA && pointB && pointA.score > this.settings.confidence && pointB.score > this.settings.confidence) {
                            this.overlayCtx.beginPath();
                            this.overlayCtx.moveTo(offX + pointA.x * scale, offY + pointA.y * scale);
                            this.overlayCtx.lineTo(offX + pointB.x * scale, offY + pointB.y * scale);
                            this.overlayCtx.stroke();
                        }
                    });

                    this.overlayCtx.fillStyle = '#FF2D55';
                    pose.keypoints.forEach(keypoint => {
                        if (keypoint.score > this.settings.confidence) {
                            const kx = offX + (keypoint.x * scale);
                            const ky = offY + (keypoint.y * scale);

                            this.overlayCtx.beginPath();
                            this.overlayCtx.arc(kx, ky, 4, 0, 2 * Math.PI);
                            this.overlayCtx.fill();
                        }
                    });
                }
            }
        }

        // Initialize Geye Pro Ultimate System
        const GEYE_ULTIMATE = new GeyeProUltimate();

        // Enhanced error handling for production
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            const alert = document.getElementById('alert-notification');
            if (alert) {
                alert.textContent = 'System error occurred';
                alert.style.display = 'block';
                setTimeout(() => alert.style.display = 'none', 5000);
            }
        });

        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
        });

        // Prevent context menu on buttons
        document.addEventListener('contextmenu', (event) => {
            if (event.target.classList.contains('control-btn') ||
                event.target.classList.contains('media-btn')) {
                event.preventDefault();
            }
        });

    </script>
</body>

</html>
