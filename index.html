<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Omega Finder (TH)</title>
    
    <!-- Leaflet CSS (Map) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        /* 
         * üé® OMEGA THAI DESIGN SYSTEM
         * Apple Minimal Black & White
         */
        :root {
            --bg: #FFFFFF;
            --text-main: #000000;
            --text-sub: #8E8E93;
            --border: #E5E5EA;
            --card-bg: #FFFFFF;
            --btn-bg: #000000;
            --btn-text: #FFFFFF;
            --nav-bg: rgba(255, 255, 255, 0.95);
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
            --font-stack: -apple-system, "Thonburi", "Sukhumvit Set", sans-serif;
            --ease: cubic-bezier(0.25, 1, 0.5, 1);
        }

        /* Dark Mode Support (Auto) */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #000000;
                --text-main: #FFFFFF;
                --text-sub: #8E8E93;
                --border: #38383A;
                --card-bg: #1C1C1E;
                --btn-bg: #FFFFFF;
                --btn-text: #000000;
                --nav-bg: rgba(28, 28, 30, 0.95);
            }
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body {
            margin: 0; padding: 0;
            background: var(--bg); color: var(--text-main);
            font-family: var(--font-stack);
            overflow: hidden; height: 100vh; width: 100vw;
            display: flex; flex-direction: column;
        }

        /* TYPOGRAPHY */
        h1 { font-size: 28px; font-weight: 700; margin: 0 0 10px 0; letter-spacing: -0.5px; }
        h2 { font-size: 20px; font-weight: 600; margin: 0; }
        p { font-size: 16px; color: var(--text-sub); margin: 0; line-height: 1.5; }
        .caption { font-size: 13px; color: var(--text-sub); }

        /* COMPONENTS */
        .btn {
            width: 100%; padding: 16px; border-radius: 14px;
            background: var(--btn-bg); color: var(--btn-text);
            font-size: 17px; font-weight: 600; text-align: center;
            border: none; cursor: pointer; transition: transform 0.1s;
            margin-top: 10px;
        }
        .btn:active { transform: scale(0.96); opacity: 0.9; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-main); }
        .btn-text { background: transparent; color: var(--text-sub); margin-top: 15px; }

        /* SCREEN TRANSITIONS */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 10;
            display: flex; flex-direction: column;
            opacity: 0; pointer-events: none; transform: scale(0.95);
            transition: opacity 0.4s var(--ease), transform 0.4s var(--ease);
            padding-top: var(--safe-top);
        }
        .screen.active { opacity: 1; pointer-events: auto; transform: scale(1); z-index: 20; }
        .screen.hidden { display: none; }

        /* 1. SPLASH */
        #splash { align-items: center; justify-content: center; z-index: 100; background: var(--bg); }
        .loader {
            width: 30px; height: 30px; border: 3px solid rgba(128,128,128,0.2);
            border-top: 3px solid var(--text-main); border-radius: 50%;
            animation: spin 1s linear infinite; margin-top: 20px;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* 2. PERMISSIONS & ONBOARDING */
        .content-box { padding: 30px; flex-grow: 1; display: flex; flex-direction: column; justify-content: flex-end; }
        .icon-hero { font-size: 60px; margin-bottom: 20px; }

        /* 3. HOME & MAP */
        #map-container { flex-grow: 1; width: 100%; position: relative; z-index: 1; background: #f0f0f0; }
        /* Grayscale Map Filter */
        .leaflet-layer { filter: grayscale(100%); }
        
        /* Device Card on Map */
        .map-card {
            position: absolute; bottom: calc(90px + var(--safe-bottom)); left: 16px; right: 16px;
            background: var(--card-bg); border-radius: 20px; padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); z-index: 400;
            border: 1px solid var(--border);
        }
        .device-row { display: flex; align-items: center; margin-bottom: 15px; }
        .device-icon { 
            width: 50px; height: 50px; background: #F2F2F7; border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; font-size: 24px; margin-right: 15px; 
        }

        /* 4. LISTS (DEVICES & SETTINGS) */
        .page-header { padding: 20px 20px 10px 20px; }
        .list-group { margin: 20px; background: var(--card-bg); border-radius: 12px; overflow: hidden; border: 1px solid var(--border); }
        .list-item {
            padding: 16px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border); background: var(--card-bg); font-size: 17px;
        }
        .list-item:last-child { border-bottom: none; }
        .arrow-right { color: var(--border); font-weight: bold; }

        /* 5. BOTTOM NAVIGATION */
        .tab-bar {
            position: absolute; bottom: 0; left: 0; width: 100%; height: calc(60px + var(--safe-bottom));
            background: var(--nav-bg); border-top: 1px solid var(--border);
            display: flex; justify-content: space-around; padding-top: 10px;
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            z-index: 50; padding-bottom: var(--safe-bottom);
        }
        .tab-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: var(--text-sub); width: 60px; font-size: 10px; gap: 4px;
        }
        .tab-item svg { width: 24px; height: 24px; stroke: currentColor; stroke-width: 2; fill: none; }
        .tab-item.active { color: var(--text-main); }

        /* 6. PRECISION AR VIEW */
        #ar-view { background: #000; z-index: 200; }
        video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.6; }
        .ar-overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 201; 
        }
        .ar-arrow {
            width: 0; height: 0; 
            border-left: 30px solid transparent; border-right: 30px solid transparent; border-bottom: 100px solid white;
            margin-bottom: 30px; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
            will-change: transform;
        }
        .ar-dist { font-size: 64px; font-weight: 800; color: white; letter-spacing: -2px; }
        .ar-unit { font-size: 20px; color: rgba(255,255,255,0.7); margin-top: -10px; }
        
        .close-ar {
            position: absolute; top: calc(20px + var(--safe-top)); left: 20px;
            background: rgba(255,255,255,0.2); backdrop-filter: blur(10px);
            padding: 8px 16px; border-radius: 20px; color: white; border: 1px solid rgba(255,255,255,0.3);
            font-size: 14px; z-index: 202;
        }

    </style>
</head>
<body>

    <!-- 1. SPLASH SCREEN -->
    <div id="splash" class="screen active">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"></path>
        </svg>
        <div class="loader"></div>
        <p style="margin-top: 10px; font-size: 14px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>

    <!-- 2. PERMISSIONS -->
    <div id="permissions" class="screen">
        <div class="content-box">
            <div class="icon-hero">üîí</div>
            <h1>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</h1>
            <p>‡πÇ‡∏õ‡∏£‡∏î‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡∏Å‡∏•‡πâ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á</p>
            <div style="height: 30px;"></div>
            <button class="btn" onclick="app.grantPermissions()">‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á</button>
            <button class="btn btn-text" onclick="app.finishSetup()">‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≤‡∏ò‡∏¥‡∏ï</button>
        </div>
    </div>

    <!-- 3. ONBOARDING -->
    <div id="onboarding" class="screen">
        <div class="content-box">
            <div id="slide-content">
                <div class="icon-hero">üåè</div>
                <h1>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h1>
                <p>‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô ‡∏Ñ‡∏∏‡∏ì‡∏Å‡πá‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πà‡∏ß‡πÇ‡∏•‡∏Å</p>
            </div>
            <div style="height: 30px;"></div>
            <button class="btn" onclick="app.finishOnboarding()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
        </div>
    </div>

    <!-- 4. HOME SCREEN -->
    <div id="home" class="screen">
        <div id="map-container"></div>
        
        <!-- Nearby Device Card -->
        <div class="map-card">
            <div class="device-row">
                <div class="device-icon">üéí</div>
                <div>
                    <h2>‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</h2>
                    <p class="caption">‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏∏‡∏ì ‚Ä¢ 2 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</p>
                </div>
                <div style="margin-left:auto; font-size:24px; color:var(--text-sub)">‚Ä∫</div>
            </div>
            <button class="btn" onclick="app.startAR()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
        </div>
    </div>

    <!-- 5. DEVICES LIST -->
    <div id="devices" class="screen">
        <div class="page-header">
            <h1>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h1>
        </div>
        <div class="list-group">
            <div class="list-item">
                <div style="display:flex; align-items:center;">
                    <div class="device-icon" style="width:40px; height:40px; font-size:20px; margin-right:12px;">üéí</div>
                    <div>
                        <div>‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</div>
                        <div class="caption">‡∏™‡∏¢‡∏≤‡∏°‡∏û‡∏≤‡∏£‡∏≤‡∏Å‡∏≠‡∏ô</div>
                    </div>
                </div>
                <span class="arrow-right">‚Ä∫</span>
            </div>
            <div class="list-item">
                <div style="display:flex; align-items:center;">
                    <div class="device-icon" style="width:40px; height:40px; font-size:20px; margin-right:12px;">üîë</div>
                    <div>
                        <div>‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏ö‡πâ‡∏≤‡∏ô</div>
                        <div class="caption">‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô ‚Ä¢ 1 ‡∏ä‡∏°. ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
                    </div>
                </div>
                <span class="arrow-right">‚Ä∫</span>
            </div>
            <div class="list-item">
                <div style="display:flex; align-items:center;">
                    <div class="device-icon" style="width:40px; height:40px; font-size:20px; margin-right:12px;">üêà</div>
                    <div>
                        <div>‡πÅ‡∏°‡∏ß‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</div>
                        <div class="caption">‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô ‚Ä¢ ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
                    </div>
                </div>
                <span class="arrow-right">‚Ä∫</span>
            </div>
        </div>
    </div>

    <!-- 6. SETTINGS -->
    <div id="settings" class="screen">
        <div class="page-header">
            <h1>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h1>
        </div>
        <div class="list-group">
            <div class="list-item">
                <span>‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á</span>
                <span style="color:var(--text-sub)">‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà</span>
            </div>
            <div class="list-item">
                <span>‡∏ò‡∏µ‡∏°‡∏™‡∏µ</span>
                <span style="color:var(--text-sub)">‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span>
            </div>
        </div>
        <div class="list-group">
            <div class="list-item">
                <span>‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
                <span class="arrow-right">‚Ä∫</span>
            </div>
            <div class="list-item">
                <span>‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÅ‡∏≠‡∏õ</span>
                <span class="arrow-right">‚Ä∫</span>
            </div>
            <div class="list-item" onclick="localStorage.clear(); location.reload();">
                <span style="color: red;">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
            </div>
        </div>
    </div>

    <!-- BOTTOM NAVIGATION BAR -->
    <div id="tab-bar" class="tab-bar" style="display:none;">
        <div class="tab-item active" onclick="app.nav('home')">
            <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
        </div>
        <div class="tab-item" onclick="app.nav('devices')">
            <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
            ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
        </div>
        <div class="tab-item" onclick="app.nav('settings')">
            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        </div>
    </div>

    <!-- 7. PRECISION AR SCREEN -->
    <div id="ar-view" class="screen">
        <video id="cam-feed" autoplay playsinline muted></video>
        <div class="close-ar" onclick="app.stopAR()">‚úï ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
        <div class="ar-overlay">
            <div id="ar-arrow" class="ar-arrow"></div>
            <div id="ar-dist" class="ar-dist">0.0</div>
            <div class="ar-unit">‡πÄ‡∏°‡∏ï‡∏£</div>
        </div>
    </div>

<script>
/**
 * ‚öôÔ∏è OMEGA ENGINE (Thai Version)
 * Logic for Navigation, Map, and AR
 */
class OmegaApp {
    constructor() {
        this.currentScreen = 'splash';
        this.target = { lat: 13.7469, lng: 100.5349 }; // Example: Siam Paragon
        this.myPos = { lat: 0, lng: 0, heading: 0 };
        this.isTracking = false;
        
        // Wait for DOM
        setTimeout(() => this.init(), 1500);
    }

    init() {
        // Check if onboarding is done
        const isSetup = localStorage.getItem('omega_thai_setup');
        
        if (!isSetup) {
            this.goTo('permissions');
        } else {
            this.goTo('home');
            this.initMap();
        }
    }

    // --- NAVIGATION LOGIC ---
    goTo(screenId) {
        // Toggle Screens
        document.querySelectorAll('.screen').forEach(el => {
            el.classList.remove('active');
            if(el.id === screenId) el.classList.add('active');
        });

        // Toggle Tab Bar Visibility
        const mainScreens = ['home', 'devices', 'settings'];
        const tabBar = document.getElementById('tab-bar');
        
        if (mainScreens.includes(screenId)) {
            tabBar.style.display = 'flex';
            this.updateTabActive(screenId);
        } else {
            tabBar.style.display = 'none';
        }
    }

    updateTabActive(screenId) {
        // Reset Tabs
        const tabs = document.querySelectorAll('.tab-item');
        tabs.forEach((t, index) => {
            t.classList.remove('active');
            // Check index mapping: 0=home, 1=devices, 2=settings
            if (screenId === 'home' && index === 0) t.classList.add('active');
            if (screenId === 'devices' && index === 1) t.classList.add('active');
            if (screenId === 'settings' && index === 2) t.classList.add('active');
        });
    }

    nav(screenId) {
        this.goTo(screenId);
        if(screenId === 'home') this.initMap();
    }

    // --- SETUP FLOW ---
    async grantPermissions() {
        // Ask for iOS Compass
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            try { await DeviceOrientationEvent.requestPermission(); } catch(e) {}
        }
        // Ask for Camera
        try {
            await navigator.mediaDevices.getUserMedia({ video: true });
            navigator.geolocation.getCurrentPosition(()=>{}, ()=>{});
            this.finishSetup();
        } catch (e) {
            alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏î‡πâ ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≤‡∏ò‡∏¥‡∏ï");
            this.finishSetup();
        }
    }

    finishSetup() {
        this.goTo('onboarding');
    }

    finishOnboarding() {
        localStorage.setItem('omega_thai_setup', 'true');
        this.goTo('home');
        this.initMap();
    }

    // --- MAP ENGINE ---
    initMap() {
        if (this.map) return;
        
        // Default to Bangkok
        this.map = L.map('map-container', { zoomControl: false, attributionControl: false }).setView([13.7563, 100.5018], 13);
        
        // Use OSM tiles but grayscale them via CSS
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(this.map);
        
        // Add fake device marker
        const icon = L.divIcon({
            className: 'custom-pin',
            html: `<div style="width:14px; height:14px; background:black; border:2px solid white; border-radius:50%; box-shadow:0 2px 5px rgba(0,0,0,0.3);"></div>`
        });
        L.marker([13.7469, 100.5349], {icon: icon}).addTo(this.map);
    }

    // --- AR LOGIC ---
    async startAR() {
        // Start Camera
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
            document.getElementById('cam-feed').srcObject = stream;
        } catch(e) { console.log("Camera Error"); }

        // Start Sensors
        this.watchId = navigator.geolocation.watchPosition(p => {
            this.myPos.lat = p.coords.latitude;
            this.myPos.lng = p.coords.longitude;
        });

        window.addEventListener('deviceorientation', this.handleCompass);
        
        this.isTracking = true;
        this.goTo('ar-view');
        this.loop();

        // Simulate distance decreasing for demo
        this.demoDist = 15.0;
    }

    stopAR() {
        this.isTracking = false;
        navigator.geolocation.clearWatch(this.watchId);
        window.removeEventListener('deviceorientation', this.handleCompass);
        this.goTo('home');
    }

    handleCompass = (e) => {
        let heading = e.webkitCompassHeading || (360 - e.alpha);
        this.myPos.heading = heading || 0;
    }

    loop() {
        if (!this.isTracking) return;
        requestAnimationFrame(() => this.loop());

        // Simulate logic
        this.demoDist -= 0.05;
        if(this.demoDist < 0.5) this.demoDist = 0.5;

        // Update UI
        document.getElementById('ar-dist').innerText = this.demoDist.toFixed(1);
        
        // Rotate Arrow (Fake rotation for demo based on compass)
        // In real app, calculate bearing(myPos, target) - heading
        let rotation = 45 - this.myPos.heading; 
        document.getElementById('ar-arrow').style.transform = `rotate(${rotation}deg)`;
    }
}

// Start App
const app = new OmegaApp();

</script>
</body>
</html>
