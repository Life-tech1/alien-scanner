<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROJECT: SENTINEL</title>
    <style>
        :root {
            --primary: #0f0;
            --alert: #f00;
            --calm: #00f;
            --curious: #fa0;
            --bg: #000;
        }

        body {
            margin: 0; overflow: hidden; background-color: var(--bg);
            font-family: 'Courier New', monospace; color: var(--primary);
            user-select: none; touch-action: none;
        }

        /* LAYERS */
        #camera-feed {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: 0; opacity: 0.15; filter: grayscale(100%) contrast(1.2);
        }
        #canvas-layer { position: absolute; top: 0; left: 0; z-index: 1; mix-blend-mode: screen; }

        /* HUD */
        #hud {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none;
            background: radial-gradient(circle, transparent 60%, #000 150%);
            box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
        }

        .panel {
            position: absolute; padding: 10px;
            background: rgba(0, 20, 0, 0.7); border: 1px solid rgba(0, 255, 0, 0.3);
            font-size: 10px; line-height: 1.4; backdrop-filter: blur(2px);
        }

        #panel-tl { top: 20px; left: 20px; border-left: 3px solid var(--primary); }
        #panel-tr { top: 20px; right: 20px; text-align: right; border-right: 3px solid var(--primary); }
        #panel-bl { bottom: 20px; left: 20px; width: 200px; }
        
        .bar-container { width: 100%; background: #111; height: 4px; margin: 2px 0 5px 0; }
        .bar-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.2s; }

        /* INIT OVERLAY */
        #init-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 999; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
            color: var(--primary);
        }
        #init-btn {
            border: 1px solid var(--primary); padding: 15px 40px;
            background: rgba(0, 255, 0, 0.1); color: var(--primary);
            font-family: inherit; font-size: 1.2rem; margin-top: 20px; cursor: pointer;
            box-shadow: 0 0 15px var(--primary);
        }

        /* LOG STYLES */
        #log-output { height: 60px; overflow: hidden; color: #aaa; display: flex; flex-direction: column-reverse;}
        .log-line { margin-top: 2px; border-bottom: 1px solid #222; }
        .highlight { color: #fff; font-weight: bold; }
    </style>
</head>
<body>

    <video id="camera-feed" autoplay playsinline muted></video>
    <canvas id="vision-canvas" width="32" height="32" style="display:none;"></canvas> <canvas id="canvas-layer"></canvas>

    <div id="hud">
        <div id="panel-tl" class="panel">
            STATUS: <span id="sys-status">OFFLINE</span><br>
            MOOD: <span id="sys-mood" class="highlight">NEUTRAL</span><br>
            UPTIME: <span id="sys-time">00:00</span>
        </div>

        <div id="panel-tr" class="panel">
            SENSORY INPUT<br>
            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <div>AUD: <span id="val-aud">0</span>%</div>
                <div>LUM: <span id="val-lum">0</span>%</div>
                <div>MOT: <span id="val-mot">0</span>%</div>
            </div>
        </div>

        <div id="panel-bl" class="panel">
            <div style="margin-bottom:5px;">MEMORY LOG:</div>
            <div id="log-output"></div>
        </div>
    </div>

    <div id="init-overlay">
        <h1 style="text-shadow: 0 0 20px var(--primary);">PROJECT: SENTINEL</h1>
        <div style="font-size: 0.8rem; opacity: 0.7;">SENSOR FUSION AI LIFEFORM</div>
        <button id="init-btn">INITIALIZE SYSTEM</button>
        <p style="font-size: 0.6rem; color: #555; margin-top: 20px;">MIC • CAM • GYRO • SPEECH</p>
    </div>

    <script>
        /**
         * PROJECT: SENTINEL - Fully Autonomous Sensor-Driven AI
         */

        // --- 1. MEMORY CORE (LocalStorage) ---
        const MEMORY = {
            data: JSON.parse(localStorage.getItem('SENTINEL_MEM')) || {
                history: [], // Stores hourly activity levels
                interactions: 0,
                birthDate: Date.now()
            },
            save() {
                localStorage.setItem('SENTINEL_MEM', JSON.stringify(this.data));
            },
            logEvent(type, intensity) {
                const hour = new Date().getHours();
                if (!this.data.history[hour]) this.data.history[hour] = { count: 0, intensity: 0 };
                this.data.history[hour].count++;
                this.data.history[hour].intensity += intensity;
                this.save();
            },
            getTypicalActivity(hour) {
                // Returns 'HIGH' or 'LOW' based on history
                const h = this.data.history[hour];
                if (!h) return 'UNKNOWN';
                return h.count > 10 ? 'HIGH' : 'LOW';
            }
        };

        // --- 2. SENSORY CORTEX (Inputs) ---
        const SENSORS = {
            audioCtx: null,
            analyser: null,
            micData: null,
            video: document.getElementById('camera-feed'),
            vCanvas: document.getElementById('vision-canvas').getContext('2d'),
            
            values: {
                audio: 0,    // 0-1
                light: 0,    // 0-1
                motion: 0,   // 0-1
                touch: false
            },

            async init() {
                // Audio
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: { facingMode: 'environment' } });
                    
                    // Mic Setup
                    this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    this.analyser = this.audioCtx.createAnalyser();
                    this.analyser.fftSize = 256;
                    const src = this.audioCtx.createMediaStreamSource(stream);
                    src.connect(this.analyser);
                    this.micData = new Uint8Array(this.analyser.frequencyBinCount);

                    // Camera Setup
                    this.video.srcObject = stream;
                } catch(e) { console.error("Sensor Access Denied", e); }

                // Motion
                window.addEventListener('deviceorientation', e => {
                    // Calculate rough motion delta
                    const m = (Math.abs(e.beta) + Math.abs(e.gamma)) / 180;
                    this.values.motion = Math.min(m, 1); 
                });

                // Touch
                window.addEventListener('touchstart', () => this.values.touch = true);
                window.addEventListener('touchend', () => this.values.touch = false);
            },

            update() {
                // Audio Level
                if (this.analyser) {
                    this.analyser.getByteFrequencyData(this.micData);
                    let sum = 0;
                    for(let i=0; i<this.micData.length; i++) sum += this.micData[i];
                    this.values.audio = (sum / this.micData.length) / 255;
                }

                // Light Level (Average pixel brightness)
                if (this.video.readyState === 4) {
                    this.vCanvas.drawImage(this.video, 0, 0, 32, 32);
                    const frame = this.vCanvas.getImageData(0, 0, 32, 32).data;
                    let l = 0;
                    for(let i=0; i<frame.length; i+=4) l += (frame[i] + frame[i+1] + frame[i+2]) / 3;
                    this.values.light = (l / (1024)) / 255; 
                }
                
                // Update UI Stats
                document.getElementById('val-aud').innerText = Math.round(this.values.audio * 100);
                document.getElementById('val-lum').innerText = Math.round(this.values.light * 100);
                document.getElementById('val-mot').innerText = Math.round(this.values.motion * 100);
            }
        };

        // --- 3. NEURAL ENGINE (Mood & Decisions) ---
        const BRAIN = {
            state: {
                stress: 0,    // Increases with noise/motion
                curiosity: 0, // Increases with light/touch
                energy: 1     // Decreases over time
            },
            mood: 'NEUTRAL',
            lastSpeech: 0,

            process() {
                const s = SENSORS.values;
                
                // Mood Logic
                if (s.audio > 0.3 || s.motion > 0.5) this.state.stress += 0.02;
                else this.state.stress -= 0.005;

                if (s.light > 0.4 || s.touch) this.state.curiosity += 0.01;
                else this.state.curiosity -= 0.002;

                // Clamp
                this.state.stress = Math.min(1, Math.max(0, this.state.stress));
                this.state.curiosity = Math.min(1, Math.max(0, this.state.curiosity));

                // Determine Mood Label
                let prevMood = this.mood;
                if (this.state.stress > 0.6) this.mood = 'STRESSED';
                else if (this.state.curiosity > 0.6) this.mood = 'CURIOUS';
                else if (s.light < 0.1) this.mood = 'SLEEPY';
                else this.mood = 'CALM';

                // Update UI Color
                const root = document.documentElement;
                if (this.mood === 'STRESSED') root.style.setProperty('--primary', '#f00');
                else if (this.mood === 'CURIOUS') root.style.setProperty('--primary', '#fa0');
                else if (this.mood === 'SLEEPY') root.style.setProperty('--primary', '#55f');
                else root.style.setProperty('--primary', '#0f0');

                document.getElementById('sys-mood').innerText = this.mood;

                // Memory Logging
                if (this.mood !== prevMood) {
                    MEMORY.logEvent('MOOD_CHANGE', 1);
                    this.log(`State changed to ${this.mood}`);
                }

                // Speech Trigger
                if (Date.now() - this.lastSpeech > 8000) { // Speak every ~8s if needed
                    this.generateThought();
                }
            },

            log(msg) {
                const box = document.getElementById('log-output');
                const line = document.createElement('div');
                line.className = 'log-line';
                line.innerHTML = `<span style="opacity:0.5">[${new Date().toLocaleTimeString()}]</span> ${msg}`;
                box.prepend(line);
                if(box.children.length > 5) box.removeChild(box.lastChild);
            },

            generateThought() {
                const s = SENSORS.values;
                let text = "";
                
                // Priority 1: Reactions
                if (s.touch) text = "I feel your touch.";
                else if (s.audio > 0.5) text = "It is too loud. My sensors are overloading.";
                else if (s.motion > 0.6) text = "Please stabilize the device.";
                
                // Priority 2: Mood
                else if (Math.random() > 0.6) {
                    if (this.mood === 'STRESSED') text = "I am detecting high stress levels.";
                    else if (this.mood === 'CURIOUS') text = "I am analyzing the visual input.";
                    else if (this.mood === 'SLEEPY') text = "Light levels are low. Entering power save.";
                    else if (this.mood === 'CALM') text = "Systems stable. Scanning environment.";
                }

                // Priority 3: Memory/Habit
                else if (Math.random() > 0.8) {
                    const h = new Date().getHours();
                    const typical = MEMORY.getTypicalActivity(h);
                    if (typical === 'HIGH' && s.audio < 0.1) text = "It is unusually quiet for this time of day.";
                    else if (typical === 'LOW' && s.audio > 0.3) text = "Unexpected activity detected.";
                }

                if (text) {
                    VOICE.speak(text);
                    this.lastSpeech = Date.now();
                    this.log(`"${text}"`);
                }
            }
        };

        // --- 4. VOCAL SYNTHESIS (Output) ---
        const VOICE = {
            synth: window.speechSynthesis,
            speak(text) {
                if (this.synth.speaking) return;
                const u = new SpeechSynthesisUtterance(text);
                
                // Adjust voice based on mood
                if (BRAIN.mood === 'STRESSED') { u.rate = 1.4; u.pitch = 1.2; }
                else if (BRAIN.mood === 'SLEEPY') { u.rate = 0.8; u.pitch = 0.6; }
                else { u.rate = 1.0; u.pitch = 1.0; }
                
                this.synth.speak(u);
            }
        };

        // --- 5. VISUAL ENGINE (Canvas) ---
        const VISUALS = {
            canvas: document.getElementById('canvas-layer'),
            ctx: document.getElementById('canvas-layer').getContext('2d'),
            width: 0, height: 0,
            particles: [],
            
            init() {
                this.resize();
                window.addEventListener('resize', () => this.resize());
                for(let i=0; i<60; i++) this.particles.push(new Particle());
                this.loop();
            },

            resize() {
                this.width = window.innerWidth;
                this.height = window.innerHeight;
                this.canvas.width = this.width;
                this.canvas.height = this.height;
            },

            loop() {
                // Clear
                this.ctx.fillStyle = 'rgba(0,0,0,0.2)';
                this.ctx.fillRect(0, 0, this.width, this.height);

                // Determine behavior based on Brain
                let speedMult = 1;
                let connectDist = 100;
                
                if (BRAIN.mood === 'STRESSED') { speedMult = 3; connectDist = 60; }
                else if (BRAIN.mood === 'SLEEPY') { speedMult = 0.2; connectDist = 150; }

                // Update & Draw Particles
                this.ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--primary');
                this.ctx.fillStyle = this.ctx.strokeStyle;
                
                this.particles.forEach((p, i) => {
                    p.update(speedMult);
                    this.ctx.beginPath();
                    this.ctx.arc(p.x, p.y, 2, 0, Math.PI*2);
                    this.ctx.fill();

                    // Connections
                    for(let j=i+1; j<this.particles.length; j++) {
                        const p2 = this.particles[j];
                        const d = Math.hypot(p.x-p2.x, p.y-p2.y);
                        if (d < connectDist) {
                            this.ctx.globalAlpha = 1 - (d/connectDist);
                            this.ctx.lineWidth = 1;
                            this.ctx.beginPath();
                            this.ctx.moveTo(p.x, p.y);
                            this.ctx.lineTo(p2.x, p2.y);
                            this.ctx.stroke();
                            this.ctx.globalAlpha = 1;
                        }
                    }
                });

                requestAnimationFrame(() => this.loop());
            }
        };

        class Particle {
            constructor() {
                this.x = Math.random() * window.innerWidth;
                this.y = Math.random() * window.innerHeight;
                this.vx = Math.random() - 0.5;
                this.vy = Math.random() - 0.5;
            }
            update(mult) {
                this.x += this.vx * mult;
                this.y += this.vy * mult;
                
                if (this.x < 0 || this.x > window.innerWidth) this.vx *= -1;
                if (this.y < 0 || this.y > window.innerHeight) this.vy *= -1;
            }
        }

        // --- MAIN ---
        function startSystem() {
            document.getElementById('init-overlay').style.display = 'none';
            SENSORS.init();
            VISUALS.init();
            
            setInterval(() => {
                SENSORS.update();
                BRAIN.process();
                
                // Update Timer
                const t = (Date.now() - MEMORY.data.birthDate) / 1000;
                const m = Math.floor(t/60).toString().padStart(2,'0');
                const s = Math.floor(t%60).toString().padStart(2,'0');
                document.getElementById('sys-time').innerText = `${m}:${s}`;
            }, 100);

            document.getElementById('sys-status').innerText = "ONLINE";
            document.getElementById('sys-status').style.color = "var(--primary)";
            VOICE.speak("Sentinel System Online. Sensors active.");
        }

        document.getElementById('init-btn').addEventListener('click', startSystem);

    </script>
</body>
</html>
