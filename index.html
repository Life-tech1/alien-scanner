<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AURA ORACLE v4.0 | Weather OS</title>

    <!-- Typography: Outfit (EN) & Anuphan (TH) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anuphan:wght@300;400;500;600&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           ðŸŽ¨ AURA HYBRID PASTEL SYSTEM (STRICT)
           ========================================= */
        :root {
            /* 1. Base Atmosphere */
            --bg-cloud: #F7F9FC;
            --bg-mist: #EEF1F6;
            --bg-glass-card: rgba(255, 255, 255, 0.80);
            --bg-glass-heavy: rgba(255, 255, 255, 0.92);

            /* 2. Hybrid Pastels */
            --p-sky: #A8D8FF;
            --p-breeze: #A9E9F7;
            --p-amber: #FFDBA3;
            --p-lavender: #C3B4FF;
            --p-indigo: #8A9BFF;
            --p-mint: #9CE5B5;
            --p-rose: #FFB3B3;

            /* 3. Gradients (Mesh System) */
            --mesh-grad: radial-gradient(at 0% 0%, rgba(168, 216, 255, 0.3) 0%, transparent 50%),
                         radial-gradient(at 100% 0%, rgba(195, 180, 255, 0.25) 0%, transparent 50%),
                         radial-gradient(at 50% 100%, rgba(255, 219, 163, 0.15) 0%, transparent 60%);

            /* 4. Text Tones */
            --tx-charcoal: #2A2D33;
            --tx-soft: #6D7380;
            --tx-light: #9AA0AC;

            /* 5. System Tokens */
            --shadow-float: 
                0 15px 40px -10px rgba(168, 216, 255, 0.3),
                0 4px 12px -4px rgba(42, 45, 51, 0.05);
            
            --glow-pulse: 0 0 15px rgba(195, 180, 255, 0.6);
            --radius-xl: 32px;
            --radius-l: 24px;
            --radius-m: 16px;
            
            --font-en: 'Outfit', sans-serif;
            --font-th: 'Anuphan', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-cloud);
            color: var(--tx-charcoal);
            font-family: var(--font-en);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Mesh Background */
        .ambient-mesh {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: var(--mesh-grad);
            z-index: -1;
            filter: blur(60px);
            animation: breathe 10s infinite ease-in-out;
        }

        .app-frame {
            width: 100%; max-width: 440px;
            padding: 24px; padding-top: 50px; padding-bottom: 90px;
            display: flex; flex-direction: column; gap: 28px;
            opacity: 0; animation: fadeEntry 1s ease forwards;
        }

        /* --- HEADER --- */
        header { display: flex; justify-content: space-between; align-items: center; }
        .brand {
            font-size: 11px; letter-spacing: 2px; font-weight: 700;
            color: var(--p-indigo); display: flex; align-items: center; gap: 8px;
            text-transform: uppercase;
        }
        .brand-dot { width: 8px; height: 8px; background: var(--p-lavender); border-radius: 50%; box-shadow: var(--glow-pulse); }
        
        .controls { display: flex; gap: 10px; }
        .gps-btn, .lang-btn {
            background: rgba(255,255,255,0.6); border: 1px solid rgba(255,255,255,0.8);
            border-radius: 20px; padding: 6px 14px; font-size: 11px; font-weight: 600;
            color: var(--tx-soft); cursor: pointer; transition: 0.3s;
            display: flex; align-items: center; gap: 4px;
        }
        .active-btn { background: #fff; color: var(--p-indigo); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }

        /* --- HERO --- */
        .hero { display: flex; flex-direction: column; align-items: center; position: relative; margin: 10px 0; }
        .score-ring {
            width: 160px; height: 160px; border-radius: 50%;
            background: linear-gradient(135deg, #FFF, #F2F8FF);
            box-shadow: var(--shadow-float), inset 0 0 0 1px rgba(255,255,255,0.8);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            position: relative; z-index: 2;
        }
        .score-ring::after {
            content: ''; position: absolute; inset: -5px; border-radius: 50%;
            border: 1px solid var(--p-lavender); opacity: 0.3;
            animation: pulseRing 3s infinite;
        }
        .score-val { font-size: 64px; font-weight: 300; line-height: 1; color: var(--tx-charcoal); font-family: 'Outfit'; }
        .score-lbl { font-size: 11px; color: var(--tx-soft); margin-top: 4px; letter-spacing: 1px; text-transform: uppercase; }
        
        .hero-meta { margin-top: 20px; text-align: center; }
        .loc-name { font-size: 14px; font-weight: 600; color: var(--tx-charcoal); display: flex; align-items: center; gap: 6px; justify-content: center; }
        .loc-icon { width: 12px; height: 12px; fill: var(--p-indigo); }
        .weather-status { font-size: 13px; color: var(--tx-soft); margin-top: 4px; }

        /* --- REASONING PANEL --- */
        .oracle-card {
            background: var(--bg-glass-heavy); backdrop-filter: blur(30px);
            border-radius: var(--radius-l); padding: 24px;
            box-shadow: var(--shadow-float); border: 1px solid rgba(255,255,255,0.8);
            position: relative; overflow: hidden;
        }
        .ai-glow {
            position: absolute; top: 0; left: 0; width: 100%; height: 3px;
            background: linear-gradient(90deg, transparent, var(--p-lavender), transparent);
            animation: scan 3s infinite linear; opacity: 0.8;
        }
        .oracle-head { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .oracle-title { font-size: 11px; font-weight: 700; color: var(--p-indigo); letter-spacing: 1px; text-transform: uppercase; }
        .oracle-msg { font-size: 15px; line-height: 1.6; color: var(--tx-charcoal); margin-bottom: 16px; font-weight: 400; }

        .reason-box {
            background: rgba(247, 249, 252, 0.7); border-radius: 16px; padding: 14px;
            display: flex; flex-direction: column; gap: 10px;
        }
        .rb-row { display: flex; justify-content: space-between; align-items: center; font-size: 12px; }
        .rb-key { color: var(--tx-light); font-weight: 500; }
        .rb-val { font-weight: 600; color: var(--p-indigo); }
        .conf-track { width: 100%; height: 4px; background: rgba(0,0,0,0.05); border-radius: 2px; overflow: hidden; margin-top: 4px; }
        .conf-fill { height: 100%; background: var(--p-lavender); width: 0%; transition: width 1s ease; }

        /* Micro Sparklines */
        .spark-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 8px; }
        .spark-item { height: 30px; background: #fff; border-radius: 8px; position: relative; overflow: hidden; display: flex; align-items: flex-end; padding: 2px; }
        .spark-line { fill: none; stroke: var(--p-sky); stroke-width: 2; stroke-linecap: round; }
        .spark-lbl { position: absolute; top: 2px; left: 4px; font-size: 8px; color: var(--tx-light); }

        /* --- LIFE OPPORTUNITIES --- */
        .sec-title { font-size: 11px; font-weight: 700; color: var(--tx-light); letter-spacing: 1px; margin-bottom: 12px; padding-left: 4px; }
        .opp-scroll { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 4px; scroll-behavior: smooth; }
        .opp-scroll::-webkit-scrollbar { display: none; }
        
        .chip {
            min-width: 130px; padding: 12px; border-radius: 18px;
            background: #FFF; border: 1px solid rgba(255,255,255,0.8);
            box-shadow: 0 4px 10px rgba(0,0,0,0.03); flex-shrink: 0;
            position: relative; overflow: hidden; display: flex; flex-direction: column; gap: 2px;
        }
        .chip::before { content:''; position: absolute; inset:0; opacity: 0.15; z-index: 0; }
        .chip.sky::before { background: var(--p-sky); }
        .chip.amber::before { background: var(--p-amber); }
        .chip.mint::before { background: var(--p-mint); }
        
        .chip-time { font-size: 12px; font-weight: 700; color: var(--tx-charcoal); font-family: 'Outfit'; z-index: 1; }
        .chip-desc { font-size: 11px; color: var(--tx-soft); z-index: 1; }

        /* --- INSIGHT GRID --- */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card {
            background: #FFF; border-radius: 20px; padding: 16px;
            display: flex; flex-direction: column; gap: 10px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.02);
            border: 1px solid rgba(255,255,255,0.6); position: relative; overflow: hidden;
        }
        .card-icon { width: 32px; height: 32px; border-radius: 10px; background: var(--bg-mist); display: flex; justify-content: center; align-items: center; color: var(--tx-soft); }
        .card-lbl { font-size: 10px; font-weight: 700; color: var(--tx-light); text-transform: uppercase; letter-spacing: 0.5px; }
        .card-val { font-size: 13px; font-weight: 500; color: var(--tx-charcoal); display: flex; align-items: center; gap: 6px; }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; }

        /* --- INTERACTIVE TIMELINE --- */
        .timeline-box { background: #FFF; border-radius: 24px; padding: 20px; box-shadow: var(--shadow-float); }
        .timeline-row { display: flex; justify-content: space-between; position: relative; padding: 10px 0; }
        .timeline-row::after { content:''; position: absolute; top: 50%; left: 10px; right: 10px; height: 1px; background: var(--bg-mist); z-index: 0; }
        
        .t-node { z-index: 1; display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer; transition: 0.3s; min-width: 40px; }
        .t-dot { width: 10px; height: 10px; background: #FFF; border: 2px solid var(--tx-light); border-radius: 50%; transition: 0.3s; }
        .t-time { font-size: 11px; color: var(--tx-light); font-family: 'Outfit'; }
        
        .t-node.active .t-dot { transform: scale(1.4); background: var(--p-breeze); border-color: var(--p-sky); box-shadow: 0 0 0 4px rgba(169, 233, 247, 0.3); }
        .t-node.active .t-time { color: var(--p-indigo); font-weight: 700; }

        /* Animation */
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes pulseRing { 0% { transform: scale(1); opacity: 0.4; } 100% { transform: scale(1.15); opacity: 0; } }
        @keyframes scan { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        @keyframes fadeEntry { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* SVG */
        svg { fill: currentColor; }
        .hidden { display: none; }
        
        /* Utils */
        .c-good { background: var(--p-mint); }
        .c-warn { background: var(--p-amber); }
        .c-bad { background: var(--p-rose); }
        .c-sky { background: var(--p-sky); }

    </style>
</head>
<body>
    <div class="ambient-mesh"></div>

    <div class="app-frame">
        
        <!-- HEADER -->
        <header>
            <div class="brand"><div class="brand-dot"></div>Aura v4.0</div>
            <div class="controls">
                <button class="gps-btn" onclick="initGPS()">
                    <svg width="12" height="12" viewBox="0 0 24 24"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg> GPS
                </button>
                <button class="lang-btn" id="lang-btn" onclick="toggleLang()">EN</button>
            </div>
        </header>

        <!-- HERO -->
        <section class="hero">
            <div class="score-ring">
                <span class="score-val" id="score">--</span>
                <span class="score-lbl" id="score-lbl">LIFE SCORE</span>
            </div>
            <div class="hero-meta">
                <div class="loc-name">
                    <svg class="loc-icon" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                    <span id="location">Detecting...</span>
                </div>
                <div class="weather-status" id="weather-desc">Connecting to Satellites...</div>
            </div>
        </section>

        <!-- ORACLE REASONING -->
        <section class="oracle-card">
            <div class="ai-glow"></div>
            <div class="oracle-head">
                <span class="oracle-title" id="oracle-lbl">ORACLE REASONING</span>
            </div>
            <div class="oracle-msg" id="oracle-msg">Aura is analyzing atmospheric data...</div>
            
            <div class="reason-box">
                <div class="rb-row">
                    <span class="rb-key" id="conf-lbl">AI Confidence</span>
                    <span class="rb-val" id="conf-val">98%</span>
                </div>
                <div class="conf-track"><div class="conf-fill" id="conf-bar" style="width:0%"></div></div>
                
                <div class="rb-row" style="margin-top:6px;">
                    <span class="rb-key" id="factor-lbl">Key Driver</span>
                    <span class="rb-val" style="color:var(--tx-charcoal); font-weight:400;" id="factor-val">--</span>
                </div>

                <!-- Sparklines -->
                <div class="spark-grid" id="spark-grid">
                    <!-- Injected via JS -->
                </div>
            </div>
        </section>

        <!-- OPPORTUNITIES -->
        <section>
            <div class="sec-title" id="opp-lbl">LIFE OPPORTUNITIES</div>
            <div class="opp-scroll" id="opp-list">
                <!-- JS Injected -->
            </div>
        </section>

        <!-- INSIGHTS GRID -->
        <section class="grid">
            <!-- Laundry -->
            <div class="card">
                <div class="card-icon"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M18 19H6C5.45 19 5 18.55 5 18V9H19V18C19 18.55 18.55 19 18 19M16.53 5.16L14.47 4.11L14.73 3.6L12.06 2.25C11.66 2.05 11.17 2.21 10.97 2.62L10.3 4H6C4.9 4 4 4.9 4 6V18C4 19.11 4.9 20 6 20H18C19.11 20 20 19.11 20 18V6C20 4.9 19.11 4 18 4H14.89L16.53 5.16M13.5 14C13.5 14.83 12.83 15.5 12 15.5C11.17 15.5 10.5 14.83 10.5 14C10.5 13.17 11.17 12.5 12 12.5C12.83 12.5 13.5 13.17 13.5 14M15 14C15 12.34 13.66 11 12 11C10.34 11 9 12.34 9 14C9 15.66 10.34 17 12 17C13.66 17 15 15.66 15 14Z"/></svg></div>
                <div><div class="card-lbl" id="laundry-lbl">LAUNDRY</div><div class="card-val" id="laundry-val">--</div></div>
            </div>
            <!-- Pet -->
            <div class="card">
                <div class="card-icon"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M19.33 11.83C19 11.83 18.67 11.91 18.39 12.06L16.43 13.04C16.29 13.11 16.14 13.15 16 13.15C15.45 13.15 15 12.7 15 12.15V9.41L14.47 9.14C14.18 9 13.85 9 13.56 9.14L10.5 10.67V12.15C10.5 12.7 10.05 13.15 9.5 13.15C9.35 13.15 9.21 13.11 9.07 13.04L7.11 12.06C6.83 11.91 6.5 11.83 6.17 11.83C5.25 11.83 4.5 12.58 4.5 13.5V17.5C4.5 18.88 5.62 20 7 20H18.5C19.88 20 21 18.88 21 17.5V13.5C21 12.58 20.25 11.83 19.33 11.83Z"/></svg></div>
                <div><div class="card-lbl" id="pet-lbl">PET HEALTH</div><div class="card-val" id="pet-val">--</div></div>
            </div>
            <!-- Comfort -->
            <div class="card">
                <div class="card-icon"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M10,17L15,12L10,7V17Z"/></svg></div>
                <div><div class="card-lbl" id="comfort-lbl">COMFORT</div><div class="card-val" id="comfort-val">--</div></div>
            </div>
            <!-- Mold -->
            <div class="card">
                <div class="card-icon"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,7V11H7.83C8.18,9.75 9.09,8.73 10.28,8.22L11,7M13,7L13.72,8.22C14.91,8.73 15.82,9.75 16.17,11H13V7M16.17,13C15.82,14.25 14.91,15.27 13.72,15.78L13,17V13H16.17M11,17L10.28,15.78C9.09,15.27 8.18,14.25 7.83,13H11V17Z"/></svg></div>
                <div><div class="card-lbl" id="mold-lbl">MOLD RISK</div><div class="card-val" id="mold-val">--</div></div>
            </div>
        </section>

        <!-- TIMELINE -->
        <section class="timeline-box">
            <div class="sec-title" id="timeline-lbl">HOURLY TIMELINE</div>
            <div class="timeline-scroll" id="timeline-row">
                <!-- JS Injected -->
            </div>
        </section>

    </div>

    <!-- ðŸ§  AURA ENGINE V4.0 -->
    <script>
        // --- 1. STATE & CONFIG ---
        const State = {
            lang: localStorage.getItem('aura_lang_v4') || 'en',
            lat: 13.7563, // Fallback (Bangkok)
            lon: 100.5018,
            weather: null,
            aqi: null
        };

        const DICT = {
            en: {
                score: "LIFE SCORE", oracle: "ORACLE REASONING", conf: "AI Confidence",
                factor: "Key Driver", opp: "LIFE OPPORTUNITIES", time: "TIMELINE",
                laundry: "LAUNDRY", pet: "PET HEALTH", comfort: "COMFORT", mold: "MOLD RISK",
                loc_denied: "GPS Denied (Demo Mode)", connect: "Connecting...",
                chips: { shop: "Best Shopping", dry: "Fastest Dry", air: "Best Air", relax: "Relax Time" },
                status: {
                    dry: "Perfect Dry", slow: "Slow Dry", bad: "Don't Dry",
                    safe: "Safe to Play", allergy: "Allergy Risk",
                    comf: "Perfect", humid: "Too Humid", hot: "Too Hot",
                    low: "Low Risk", high: "High Risk"
                },
                msg: {
                    rain: "Precipitation inbound. Best to stay cozy indoors.",
                    hot: "Thermal load is high. Stay hydrated and seek shade.",
                    bad: "Air quality degrading. Close windows recommended.",
                    good: "Atmosphere is balanced. Enjoy the fresh air."
                },
                factors: { rain: "Precipitation", heat: "UV Index", air: "PM2.5 Drift", calm: "Stability" }
            },
            th: {
                score: "à¸„à¸°à¹à¸™à¸™à¸Šà¸µà¸§à¸´à¸•", oracle: "à¸šà¸—à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸­à¸­à¸£à¹ˆà¸²", conf: "à¸„à¸§à¸²à¸¡à¸¡à¸±à¹ˆà¸™à¹ƒà¸ˆ AI",
                factor: "à¸›à¸±à¸ˆà¸ˆà¸±à¸¢à¸«à¸¥à¸±à¸", opp: "à¹‚à¸­à¸à¸²à¸ªà¸—à¸µà¹ˆà¸”à¸µà¸—à¸µà¹ˆà¸ªà¸¸à¸”", time: "à¸žà¸¢à¸²à¸à¸£à¸“à¹Œà¸£à¸²à¸¢à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡",
                laundry: "à¸à¸²à¸£à¸‹à¸±à¸à¸œà¹‰à¸²", pet: "à¸ªà¸¸à¸‚à¸ à¸²à¸žà¸ªà¸±à¸•à¸§à¹Œà¹€à¸¥à¸µà¹‰à¸¢à¸‡", comfort: "à¸„à¸§à¸²à¸¡à¸ªà¸šà¸²à¸¢", mold: "à¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¹€à¸Šà¸·à¹‰à¸­à¸£à¸²",
                loc_denied: "à¹„à¸¡à¹ˆà¸žà¸š GPS (à¹‚à¸«à¸¡à¸”à¸ªà¸²à¸˜à¸´à¸•)", connect: "à¸à¸³à¸¥à¸±à¸‡à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­...",
                chips: { shop: "à¹€à¸§à¸¥à¸²à¸‹à¸·à¹‰à¸­à¸‚à¸­à¸‡", dry: "à¸œà¹‰à¸²à¹à¸«à¹‰à¸‡à¹„à¸§à¸ªà¸¸à¸”", air: "à¸­à¸²à¸à¸²à¸¨à¸”à¸µà¸ªà¸¸à¸”", relax: "à¹€à¸§à¸¥à¸²à¸œà¹ˆà¸­à¸™à¸„à¸¥à¸²à¸¢" },
                status: {
                    dry: "à¸•à¸²à¸à¹à¸«à¹‰à¸‡à¸ªà¸™à¸´à¸—", slow: "à¹à¸«à¹‰à¸‡à¸Šà¹‰à¸²", bad: "à¹„à¸¡à¹ˆà¸„à¸§à¸£à¸•à¸²à¸",
                    safe: "à¸§à¸´à¹ˆà¸‡à¹€à¸¥à¹ˆà¸™à¹„à¸”à¹‰", allergy: "à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸ à¸¹à¸¡à¸´à¹à¸žà¹‰",
                    comf: "à¸ªà¸šà¸²à¸¢à¸•à¸±à¸§", humid: "à¹€à¸«à¸™à¸µà¸¢à¸§à¸•à¸±à¸§", hot: "à¸£à¹‰à¸­à¸™à¸­à¸šà¸­à¹‰à¸²à¸§",
                    low: "à¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸•à¹ˆà¸³", high: "à¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸ªà¸¹à¸‡"
                },
                msg: {
                    rain: "à¸à¸™à¸à¸³à¸¥à¸±à¸‡à¸ˆà¸°à¸•à¸à¹ƒà¸™à¹„à¸¡à¹ˆà¸Šà¹‰à¸² à¸”à¸¹à¹à¸¥à¸ªà¸¸à¸‚à¸ à¸²à¸žà¹ƒà¸™à¸£à¹ˆà¸¡à¸”à¸µà¸à¸§à¹ˆà¸²à¸„à¸£à¸±à¸š",
                    hot: "à¸­à¸²à¸à¸²à¸¨à¸£à¹‰à¸­à¸™à¸ˆà¸±à¸” à¸”à¸·à¹ˆà¸¡à¸™à¹‰à¸³à¸šà¹ˆà¸­à¸¢à¹† à¹à¸¥à¸°à¹€à¸¥à¸µà¹ˆà¸¢à¸‡à¹à¸”à¸”à¸™à¸°à¸„à¸£à¸±à¸š",
                    bad: "à¸„à¹ˆà¸²à¸à¸¸à¹ˆà¸™à¹€à¸£à¸´à¹ˆà¸¡à¸ªà¸¹à¸‡ à¸›à¸´à¸”à¸«à¸™à¹‰à¸²à¸•à¹ˆà¸²à¸‡à¹€à¸žà¸·à¹ˆà¸­à¸ªà¸¸à¸‚à¸ à¸²à¸žà¸™à¸°à¸„à¸£à¸±à¸š",
                    good: "à¸šà¸£à¸£à¸¢à¸²à¸à¸²à¸¨à¸§à¸±à¸™à¸™à¸µà¹‰à¸ªà¸¡à¸”à¸¸à¸¥à¸”à¸µà¹€à¸¢à¸µà¹ˆà¸¢à¸¡ à¹€à¸«à¸¡à¸²à¸°à¹à¸à¹ˆà¸à¸²à¸£à¸žà¸±à¸à¸œà¹ˆà¸­à¸™à¸„à¸£à¸±à¸š"
                },
                factors: { rain: "à¹‚à¸­à¸à¸²à¸ªà¸à¸™à¸•à¸", heat: "à¸”à¸±à¸Šà¸™à¸µ UV", air: "à¸¥à¸¡à¸žà¸±à¸”à¸à¸¸à¹ˆà¸™", calm: "à¸„à¸§à¸²à¸¡à¸ªà¸¡à¸”à¸¸à¸¥" }
            }
        };

        // --- 2. LOGIC ENGINE ---
        const AuraBrain = {
            calcScore: (cur, aqi) => {
                let s = 100;
                if(cur.temperature_2m > 33) s -= 15;
                if(aqi > 50) s -= 20;
                if(cur.precipitation > 0) s -= 20;
                return Math.max(0, s);
            },
            
            analyze: (cur, hourly, aqi, t) => {
                // Laundry
                let l = { t: t.status.dry, c: 'c-good' };
                if(hourly.precipitation_probability[0] > 40) l = { t: t.status.bad, c: 'c-bad' };
                else if(cur.relative_humidity_2m > 70) l = { t: t.status.slow, c: 'c-warn' };

                // Pet
                let p = { t: t.status.safe, c: 'c-good' };
                if(aqi > 100 || cur.temperature_2m > 32) p = { t: t.status.allergy, c: 'c-bad' };

                // Comfort
                let c = { t: t.status.comf, c: 'c-good' };
                if(cur.temperature_2m > 30) c = { t: t.status.hot, c: 'c-warn' };
                else if(cur.relative_humidity_2m > 80) c = { t: t.status.humid, c: 'c-warn' };

                // Mold
                let m = { t: t.status.low, c: 'c-good' };
                if(cur.relative_humidity_2m > 75) m = { t: t.status.high, c: 'c-warn' };

                // Oracle
                let msg = t.msg.good;
                let fac = t.factors.calm;
                if(aqi > 100) { msg = t.msg.bad; fac = t.factors.air; }
                else if(cur.precipitation > 0 || hourly.precipitation_probability[0] > 50) { msg = t.msg.rain; fac = t.factors.rain; }
                else if(cur.temperature_2m > 33) { msg = t.msg.hot; fac = t.factors.heat; }

                return { laundry: l, pet: p, comfort: c, mold: m, msg, fac };
            },

            findOpps: (hourly, t) => {
                // Simplified Logic for Demo
                return [
                    { time: "11:00", txt: t.chips.shop, type: "amber" },
                    { time: "14:00", txt: t.chips.dry, type: "sky" },
                    { time: "19:00", txt: t.chips.relax, type: "mint" }
                ];
            }
        };

        // --- 3. API & DATA ---
        async function fetchData() {
            try {
                // 1. Weather
                const wUrl = `https://api.open-meteo.com/v1/forecast?latitude=${State.lat}&longitude=${State.lon}&current=temperature_2m,relative_humidity_2m,precipitation,weather_code&hourly=temperature_2m,relative_humidity_2m,precipitation_probability,wind_speed_10m`;
                const wRes = await fetch(wUrl);
                const wData = await wRes.json();

                // 2. Air Quality
                const aUrl = `https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${State.lat}&longitude=${State.lon}&current=pm2_5`;
                const aRes = await fetch(aUrl);
                const aData = await aRes.json();

                State.weather = wData;
                State.aqi = aData;
                render();

            } catch(e) {
                console.error(e);
                alert("Data Fetch Error. Using Sim Data.");
            }
        }

        function initGPS() {
            document.getElementById('location').innerText = "Locating...";
            if(navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        State.lat = pos.coords.latitude;
                        State.lon = pos.coords.longitude;
                        document.getElementById('location').innerText = "GPS Fixed";
                        fetchData();
                    },
                    (err) => {
                        document.getElementById('location').innerText = DICT[State.lang].loc_denied;
                        fetchData(); // Load fallback
                    }
                );
            } else {
                fetchData();
            }
        }

        // --- 4. RENDERER ---
        function render() {
            if(!State.weather) return;

            const t = DICT[State.lang];
            const cur = State.weather.current;
            const hr = State.weather.hourly;
            const aqi = State.aqi.current.pm2_5;
            
            const analysis = AuraBrain.analyze(cur, hr, aqi, t);
            const score = AuraBrain.calcScore(cur, aqi);

            // Font
            document.body.style.fontFamily = State.lang === 'th' ? 'var(--font-th)' : 'var(--font-en)';

            // --- HERO ---
            document.getElementById('score').innerText = score;
            document.getElementById('score-lbl').innerText = t.score;
            document.getElementById('weather-desc').innerText = `${Math.round(cur.temperature_2m)}Â°C â€¢ H:${Math.round(cur.relative_humidity_2m)}%`;

            // --- ORACLE ---
            document.getElementById('oracle-lbl').innerText = t.oracle;
            document.getElementById('oracle-msg').innerText = analysis.msg;
            document.getElementById('conf-lbl').innerText = t.conf;
            document.getElementById('factor-lbl').innerText = t.factor;
            document.getElementById('factor-val').innerText = analysis.fac;
            setTimeout(() => document.getElementById('conf-bar').style.width = "94%", 300);

            // Sparklines Generation
            renderSparklines(hr);

            // --- INSIGHTS ---
            updateCard('laundry', analysis.laundry, t.laundry);
            updateCard('pet', analysis.pet, t.pet);
            updateCard('comfort', analysis.comfort, t.comfort);
            updateCard('mold', analysis.mold, t.mold);

            // --- OPPORTUNITIES ---
            document.getElementById('opp-lbl').innerText = t.opp;
            const opps = AuraBrain.findOpps(hr, t);
            const oppList = document.getElementById('opp-list');
            oppList.innerHTML = '';
            opps.forEach(o => {
                oppList.innerHTML += `
                    <div class="chip ${o.type}">
                        <span class="chip-time">${o.time}</span>
                        <span class="chip-desc">${o.txt}</span>
                    </div>
                `;
            });

            // --- TIMELINE ---
            document.getElementById('timeline-lbl').innerText = t.time;
            const tl = document.getElementById('timeline-row');
            tl.innerHTML = '';
            const currentHr = new Date().getHours();
            
            for(let i=0; i<6; i++) {
                let idx = (currentHr + i); 
                // Fix index overflow if using real data array (usually huge)
                if(idx >= hr.time.length) idx = 0; 

                let timeDisplay = (currentHr + i) % 24 + ":00";
                let tempDisplay = Math.round(hr.temperature_2m[idx]);
                let activeClass = i === 0 ? 'active' : '';
                
                tl.innerHTML += `
                    <div class="t-node ${activeClass}">
                        <div class="t-dot"></div>
                        <span class="t-time">${timeDisplay}</span>
                        <span class="t-time" style="margin-top:2px; font-weight:500">${tempDisplay}Â°</span>
                    </div>
                `;
            }

            // Lang Btn
            document.getElementById('lang-btn').innerText = State.lang === 'en' ? 'EN' : 'TH';
        }

        function updateCard(id, state, title) {
            document.getElementById(`${id}-lbl`).innerText = title;
            document.getElementById(`${id}-val`).innerHTML = `<span class="status-dot ${state.c}"></span>${state.t}`;
        }

        function renderSparklines(hr) {
            const container = document.getElementById('spark-grid');
            container.innerHTML = '';
            
            // Helper to make SVG polyline
            const createSpark = (data, color, label) => {
                const slice = data.slice(0, 10);
                const min = Math.min(...slice);
                const max = Math.max(...slice);
                const range = max - min || 1;
                
                const points = slice.map((val, i) => {
                    const x = (i / (slice.length - 1)) * 100;
                    const y = 100 - ((val - min) / range) * 80 - 10;
                    return `${x},${y}`;
                }).join(' ');

                return `
                    <div class="spark-item">
                        <span class="spark-lbl">${label}</span>
                        <svg width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="none">
                            <polyline fill="none" stroke="${color}" stroke-width="3" points="${points}" />
                        </svg>
                    </div>
                `;
            };

            container.innerHTML += createSpark(hr.temperature_2m, '#FFCB86', 'Temp');
            container.innerHTML += createSpark(hr.relative_humidity_2m, '#8FB8FF', 'Humid');
            container.innerHTML += createSpark(hr.wind_speed_10m, '#9CE5B5', 'Wind');
        }

        function toggleLang() {
            State.lang = State.lang === 'en' ? 'th' : 'en';
            render();
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            initGPS();
        });

    </script>
</body>
</html>
