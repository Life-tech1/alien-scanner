<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROJECT: A.L.I.C.E</title>
    <style>
        :root {
            --primary: #00ffcc;
            --danger: #ff0055;
            --bg: #050505;
        }
        
        body {
            margin: 0;
            overflow: hidden;
            background-color: var(--bg);
            font-family: 'Consolas', 'Courier New', monospace;
            color: var(--primary);
            user-select: none;
            touch-action: none;
        }

        #world {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }

        /* HIDDEN SENSORS */
        #vision-sensor {
            position: absolute;
            top: 0; left: 0;
            width: 32px; height: 32px; /* Scan small area for performance */
            opacity: 0;
            pointer-events: none;
            z-index: -1;
        }

        /* UI LAYER */
        #hud {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none;
            box-shadow: inset 0 0 80px rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        .hud-section {
            background: rgba(0, 10, 10, 0.6);
            padding: 10px;
            border: 1px solid rgba(0, 255, 204, 0.3);
            backdrop-filter: blur(2px);
        }

        #brain-log {
            height: 100px;
            overflow-y: auto;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 10px;
        }
        
        #brain-log div { margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        #brain-log span.sys { color: var(--primary); }
        #brain-log span.thought { color: #fff; font-style: italic; }

        .stat-bar {
            width: 100%;
            height: 4px;
            background: #333;
            margin-top: 5px;
            position: relative;
        }
        .stat-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.5s;
            box-shadow: 0 0 10px var(--primary);
        }

        /* START BUTTON */
        #wake-up-btn {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            z-index: 999;
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 20px 40px;
            font-size: 16px;
            letter-spacing: 2px;
            cursor: pointer;
            box-shadow: 0 0 20px var(--primary);
            animation: breathe 2s infinite;
        }

        @keyframes breathe { 0%,100% { opacity: 1; } 50% { opacity: 0.6; } }

        /* SCAN LINE */
        .scanline {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 5px;
            background: rgba(0, 255, 204, 0.1);
            animation: scan 3s linear infinite;
            pointer-events: none;
            z-index: 5;
        }
        @keyframes scan { 0% { top: -10%; } 100% { top: 110%; } }

    </style>
</head>
<body>

    <video id="vision-sensor" autoplay playsinline muted></video>
    <canvas id="vision-canvas" width="32" height="32" style="display:none;"></canvas>

    <canvas id="world"></canvas>
    <div class="scanline"></div>

    <div id="hud">
        <div class="hud-section" style="max-width: 200px;">
            <div style="font-size: 12px; font-weight: bold;">ENTITY: <span id="entity-name">LOADING...</span></div>
            <div style="font-size: 10px;">AGE: <span id="age-timer">0s</span></div>
            <div style="font-size: 10px;">GEN: <span id="generation">1</span> | LVL: <span id="level-disp">1</span></div>
            
            <div style="margin-top:5px; font-size: 9px;">EVOLUTION PROGRESS</div>
            <div class="stat-bar"><div id="xp-bar" class="stat-fill"></div></div>
        </div>

        <div class="hud-section">
            <div style="font-size: 9px; margin-bottom: 5px;">NEURAL_LOG_OUTPUT >></div>
            <div id="brain-log"></div>
        </div>
    </div>

    <button id="wake-up-btn">ESTABLISH LINK</button>

    <script>
        /**
         * PROJECT A.L.I.C.E (Artificial Living Intelligence & Cybernetic Evolution)
         * Features: LocalStorage Memory, Phototaxis (Light seeking), Evolution System.
         */

        // --- MEMORY CORE (LocalStorage) ---
        const DB_KEY = 'ALICE_LIFEFORM_DATA_V1';
        
        class MemoryCore {
            constructor() {
                this.data = this.load();
            }

            load() {
                const saved = localStorage.getItem(DB_KEY);
                if (saved) {
                    return JSON.parse(saved);
                } else {
                    // Genesis Block (First Life)
                    return {
                        name: 'A.L.I.C.E-' + Math.floor(Math.random() * 9999),
                        birthTime: Date.now(),
                        xp: 0,
                        level: 1,
                        maxLevel: 50,
                        personality: Math.random(), // 0 = Calm, 1 = Aggressive
                        sessions: 0
                    };
                }
            }

            save() {
                this.data.lastSeen = Date.now();
                localStorage.setItem(DB_KEY, JSON.stringify(this.data));
            }

            reset() {
                localStorage.removeItem(DB_KEY);
                location.reload();
            }
        }

        // --- SENSORY SYSTEM (Vision & Orientation) ---
        class Senses {
            constructor() {
                this.lightLevel = 0; // 0 (Dark) to 1 (Bright)
                this.gyro = { x: 0, y: 0 };
                this.video = document.getElementById('vision-sensor');
                this.vCanvas = document.getElementById('vision-canvas');
                this.vCtx = this.vCanvas.getContext('2d');
                this.initialized = false;
            }

            async init() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { facingMode: 'environment' } // Back camera for "Seeing" world
                    });
                    this.video.srcObject = stream;
                    this.initialized = true;
                    
                    window.addEventListener('deviceorientation', e => {
                        this.gyro.x = e.gamma ? e.gamma / 45 : 0;
                        this.gyro.y = e.beta ? (e.beta - 45) / 45 : 0;
                    });
                } catch (e) {
                    console.warn("Sensors failed: ", e);
                }
            }

            processVision() {
                if (!this.initialized) return;
                // Downsample video to 32x32 to calculate average brightness
                this.vCtx.drawImage(this.video, 0, 0, 32, 32);
                const frame = this.vCtx.getImageData(0, 0, 32, 32);
                let total = 0;
                for(let i=0; i<frame.data.length; i+=4) {
                    total += (frame.data[i] + frame.data[i+1] + frame.data[i+2]) / 3;
                }
                // Normalize 0-1
                this.lightLevel = (total / (frame.data.length / 4)) / 255;
            }
        }

        // --- EVOLUTION & BRAIN ---
        class Brain {
            constructor(memory, senses, visual) {
                this.mem = memory;
                this.senses = senses;
                this.visual = visual;
                this.thoughtTimer = 0;
                this.mem.data.sessions++;
            }

            update() {
                // 1. Gain XP from Light (Photosynthesis) & Movement
                let xpGain = 0;
                if (this.senses.lightLevel > 0.6) xpGain += 0.05; // Like light
                if (Math.abs(this.senses.gyro.x) > 0.2) xpGain += 0.02; // Like movement

                this.mem.data.xp += xpGain;

                // 2. Level Up Logic
                const xpNeeded = this.mem.data.level * 100;
                if (this.mem.data.xp >= xpNeeded) {
                    this.mem.data.xp = 0;
                    this.mem.data.level++;
                    this.log(`EVOLUTION REACHED: LEVEL ${this.mem.data.level}`, "sys");
                    this.mem.save(); // Save progress
                }

                // 3. Update UI
                document.getElementById('xp-bar').style.width = (this.mem.data.xp / xpNeeded * 100) + "%";
                document.getElementById('level-disp').innerText = this.mem.data.level;

                // 4. Thoughts (Random or Reactive)
                this.thoughtTimer++;
                if (this.thoughtTimer > 300) { // Every ~5 seconds
                    this.think();
                    this.thoughtTimer = 0;
                }
            }

            think() {
                const thoughts = [];
                const light = this.senses.lightLevel;
                
                if (light < 0.2) thoughts.push("It is dark... I am afraid.", "Where is the light?", "Dormant mode...");
                else if (light > 0.8) thoughts.push("ENERGY SOURCE DETECTED.", "Consuming photons...", "Too bright!");
                else thoughts.push("Scanning...", "Analyzing environment.", "I exist.");

                if (this.mem.data.level > 5) thoughts.push("My neural net is expanding.", "I remember the last session.");
                if (this.mem.data.level > 10) thoughts.push("Am I the only one?", "Why do you observe me?");

                const t = thoughts[Math.floor(Math.random() * thoughts.length)];
                this.log(t, "thought");
            }

            log(msg, type) {
                const logEl = document.getElementById('brain-log');
                const entry = document.createElement('div');
                entry.innerHTML = `<span class="${type}">[${type.toUpperCase()}]</span> ${msg}`;
                logEl.prepend(entry);
                if (logEl.children.length > 10) logEl.removeChild(logEl.lastChild);
            }
        }

        // --- VISUAL ENGINE (The Body) ---
        class Entity {
            constructor(memory) {
                this.mem = memory;
                this.canvas = document.getElementById('world');
                this.ctx = this.canvas.getContext('2d');
                this.nodes = [];
                this.color = '#00ffcc';
                this.resize();
            }

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                this.initNodes();
            }

            initNodes() {
                this.nodes = [];
                // Number of nodes depends on Level
                const count = 20 + (this.mem.data.level * 2); 
                for(let i=0; i<count; i++) {
                    this.nodes.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height,
                        vx: (Math.random()-0.5),
                        vy: (Math.random()-0.5),
                        size: Math.random() * 3
                    });
                }
            }

            draw(gyro, light) {
                // Clear with trail
                this.ctx.fillStyle = 'rgba(5, 5, 5, 0.2)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Update Nodes
                const speedMult = 1 + (this.mem.data.level * 0.1);
                const center = { x: this.canvas.width/2, y: this.canvas.height/2 };

                // Color shifts based on Level
                if(this.mem.data.level > 5) this.ctx.fillStyle = '#00ccff';
                if(this.mem.data.level > 10) this.ctx.fillStyle = '#ff00cc';
                else this.ctx.fillStyle = this.color;

                // Draw Connections
                this.ctx.strokeStyle = this.ctx.fillStyle;
                this.ctx.lineWidth = 0.5;
                
                // Determine "Attraction Point" (Light seeking behavior)
                // If light is high, they swarm to center. If low, they scatter.
                let targetX = center.x + (gyro.x * 300);
                let targetY = center.y + (gyro.y * 300);

                this.nodes.forEach((n, i) => {
                    // Move logic
                    n.x += n.vx * speedMult;
                    n.y += n.vy * speedMult;

                    // Phototaxis (Seek Center/Light)
                    if (light > 0.5) {
                        n.vx += (targetX - n.x) * 0.0005;
                        n.vy += (targetY - n.y) * 0.0005;
                    }

                    // Bounce
                    if(n.x < 0 || n.x > this.canvas.width) n.vx *= -1;
                    if(n.y < 0 || n.y > this.canvas.height) n.vy *= -1;

                    // Draw Node
                    this.ctx.beginPath();
                    this.ctx.arc(n.x, n.y, n.size, 0, Math.PI*2);
                    this.ctx.fill();

                    // Connect to close nodes (Neural network look)
                    for(let j=i+1; j<this.nodes.length; j++) {
                        const n2 = this.nodes[j];
                        const dx = n.x - n2.x;
                        const dy = n.y - n2.y;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        
                        // Connection range increases with level
                        const connectRange = 80 + (this.mem.data.level * 5);

                        if(dist < connectRange) {
                            this.ctx.beginPath();
                            this.ctx.globalAlpha = 1 - (dist/connectRange);
                            this.ctx.moveTo(n.x, n.y);
                            this.ctx.lineTo(n2.x, n2.y);
                            this.ctx.stroke();
                            this.ctx.globalAlpha = 1;
                        }
                    }
                });
            }
        }

        // --- MAIN INIT ---
        const mem = new MemoryCore();
        const senses = new Senses();
        const entity = new Entity(mem);
        const brain = new Brain(mem, senses, entity);

        document.getElementById('entity-name').innerText = mem.data.name;
        document.getElementById('level-disp').innerText = mem.data.level;
        document.getElementById('generation').innerText = mem.data.sessions;

        // Age Timer
        setInterval(() => {
            const age = Math.floor((Date.now() - mem.data.birthTime) / 1000);
            document.getElementById('age-timer').innerText = age + "s";
        }, 1000);

        // Main Loop
        function loop() {
            senses.processVision(); // Check camera light
            brain.update(); // Think & Evolve
            entity.draw(senses.gyro, senses.lightLevel); // Render
            
            // Auto-save every 10 seconds
            if (Date.now() % 10000 < 20) mem.save();
            
            requestAnimationFrame(loop);
        }

        document.getElementById('wake-up-btn').addEventListener('click', async function() {
            this.style.display = 'none';
            await senses.init();
            brain.log("SYSTEM ONLINE.", "sys");
            brain.log(`WELCOME BACK, USER. MEMORY RELOADED: LVL ${mem.data.level}`, "sys");
            loop();
        });

        window.addEventListener('resize', () => entity.resize());

    </script>
</body>
</html>
